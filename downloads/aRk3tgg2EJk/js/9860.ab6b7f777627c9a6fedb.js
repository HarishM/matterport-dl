"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[9860],{85239:(e,t,o)=>{o.d(t,{g:()=>a,l:()=>s});var i=o(13686);class s extends i.E{constructor(e){super(),this.pinchDelta=e}}class a extends i.E{constructor(e,t){super(),this.pinchDelta=e,this.timeSinceLastMove=t}}},46464:(e,t,o)=>{o.d(t,{s:()=>s});var i=o(13686);class s extends i.E{constructor(e,t){super(),this.position=e,this.delta=t}}},33518:(e,t,o)=>{o.d(t,{k:()=>s});var i=o(42399);class s extends i.T{constructor(e,t,o){super(),this.key=e,this.state=t,this.modifiers=o}}},68118:(e,t,o)=>{o.d(t,{A:()=>s});var i=o(14754);class s extends i.QB{constructor(e){super(),this.zoomLevel=e}}},49860:(e,t,o)=>{o.r(t),o.d(t,{default:()=>v});var i=o(23205),s=o(35223),a=o(46464),n=o(85239),r=o(33518),h=o(44158),m=o(44634),d=o(45018),c=o(53950),l=o(48064),u=o(49191),p=o(43998),g=o(75673),w=o(78096),D=o(12099),y=o(29100),z=o(68118),b=o(61543);class v extends i.n{constructor(){super(...arguments),this.name="zoom-controls",this.uhQuality={},this.config={enabled:!0}}async init(e,t){this.config.enabled=!!e.enabled,this.sweepTilingModule=await t.getModuleBySymbol(s.qD),this.config.enabled&&await this.registerControls(t),this.engine=t,this.cameraModule=await t.getModuleBySymbol(s.jh),this.cameraData=await t.market.waitForData(d.M),this.viewmodeData=await t.market.waitForData(l.X),this.sweepData=await t.market.waitForData(u.A),this.bindings.push(t.commandBinder.addBinding(y.EG,(async e=>this.zoomBy(e.step))),t.commandBinder.addBinding(y.De,(async e=>this.zoomBy(-e.step))),t.commandBinder.addBinding(y.i9,(async()=>this.zoomTo(1))),t.commandBinder.addBinding(y.hd,(async e=>this.zoomTo(e.value))),t.commandBinder.addBinding(y.BW,(async()=>Promise.resolve(this.getMaxZoomAvailable()))))}async registerControls(e){e.getModuleBySymbol(s.mL).then((e=>{this.bindings.push(e.registerHandler(a.s,(e=>this.zoomByInput(this.scrollToZoomDelta(e))))),this.bindings.push(e.registerHandler(n.l,(e=>this.zoomByInput(this.pinchToZoomDelta(e))))),this.bindings.push(e.registerHandler(r.k,(e=>this.keyHandler(e))))}))}zoomTo(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const{currentSweep:o,currentSweepObject:i}=this.sweepData;if(i&&this.checkTilingZoomLevels(e,i),(e=(0,p.qE)(e,D.W.minZoom,this.getMaxZoom(o)))!==t){const t=(0,g.H)(this.cameraData.baseFovY/e),o=c.Bv.near,i=c.Bv.far;this.cameraModule.updateCameraProjection((new w.k).makePerspectiveFov(t,this.cameraData.aspect(),o,i))}return this.engine.broadcast(new z.A(e)),e}checkTilingZoomLevels(e,t){if(e>=D.W.highResThreshold&&this.zoomedSweep!==t){this.zoomedSweep=t;this.sweepTilingModule.enableZooming(!0,t.id)?this.uhQuality[t.id]=!0:(this.uhQuality[t.id]=!1,this.zoomedSweep=void 0)}else e<D.W.highResThreshold&&this.zoomedSweep&&this.zoomedSweep===t&&(this.sweepTilingModule.enableZooming(!1,this.zoomedSweep.id),this.zoomedSweep=void 0)}getMaxZoom(e){return this.uhQuality[null!=e?e:"none"]?D.W.maxHighResZoom:D.W.maxZoom}zoomBy(e){const t=this.cameraData.zoom();return this.validateViewmode()?this.zoomTo(t+e):t}validateViewmode(){return this.viewmodeData.isInside()&&this.cameraData.canTransition()}scrollToZoomDelta(e){return-Math.sign(e.delta.y)*D.W.zoomStep}pinchToZoomDelta(e){return e.pinchDelta*(D.W.maxZoom-D.W.minZoom)}zoomByInput(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const o=this.sweepData.currentSweep,i=(0,p.qE)(t+e,D.W.minZoom,this.getMaxZoom(o));return this.zoomTo(i)}keyHandler(e){if(e.state===m.$.DOWN)switch(e.key){case h.D.PLUSEQUALS:this.zoomByInput(D.W.zoomStep);break;case h.D.DASHUNDERSCORE:this.zoomByInput(-D.W.zoomStep);break;case h.D.OPENBRACKET:this.zoomTo(1)}}getMaxZoomAvailable(){if(!this.sweepData.currentSweepObject)return D.W.maxZoom;return this.sweepData.currentSweepObject.availableResolution(b.MF.ULTRAHIGH)>=b.MF.ULTRAHIGH?D.W.maxHighResZoom:D.W.maxZoom}}},12099:(e,t,o)=>{o.d(t,{W:()=>i});const i={zoomStep:.1,minZoom:.7,maxZoom:2,maxHighResZoom:3,highResThreshold:1.1}}}]);