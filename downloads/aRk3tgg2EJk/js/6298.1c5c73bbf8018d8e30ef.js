(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[6298],{41234:(t,e,i)=>{"use strict";i.d(e,{EH:()=>a,nB:()=>o,v6:()=>n});var s=i(68857);const o=(t,e=200)=>{let i=0,o=0;const a=1/t,n=t=>t.width/t.height;return{resizeDimensions:[{property:s.U.width,setDimension:e=>(i=n(e)<t?e.width:e.height*t,i),duration:e},{property:s.U.height,setDimension:e=>(o=n(e)<t?e.width*a:e.height,o),duration:e},{property:s.U.top,setDimension:e=>n(e)<t?(e.height-o)/2:0,duration:e},{property:s.U.left,setDimension:e=>n(e)<t?0:(e.width-i)/2,duration:e}]}},a=(t=200)=>({resizeDimensions:[{property:s.U.width,setDimension:t=>t.width,duration:t},{property:s.U.height,setDimension:t=>t.height,duration:t},{property:s.U.top,setDimension:()=>0,duration:t},{property:s.U.left,setDimension:()=>0,duration:t}]}),n=(t,e,i,o=200)=>{const a=[];return void 0!==t&&a.push({property:s.U.width,setDimension:e=>e.width+t,duration:o}),void 0!==e&&a.push({property:s.U.height,setDimension:t=>t.height+e,duration:o}),void 0!==i&&a.push({property:s.U.left,setDimension:()=>i,duration:o}),{resizeDimensions:a}}},68857:(t,e,i)=>{"use strict";i.d(e,{E:()=>a,U:()=>s});var s,o=i(18268);!function(t){t.left="left",t.top="top",t.width="width",t.height="height"}(s||(s={}));class a extends o.u{constructor(t){super(),this.name="resize-canvas",this.payload=Object.assign({},t)}}a.id="RESIZE_CANVAS"},83085:(t,e,i)=>{"use strict";i.d(e,{m:()=>g});var s=i(74848),o=i(96540),a=i(40826),n=i(30498),r=i(78683),l=i(24684),h=i(61412),c=i(34466),d=i(23168),u=i(63591),p=i(35216),v=i(89339),m=i(76481);const g=({item:t})=>{const{analytics:e}=(0,o.useContext)(a.BR),i=(0,r.B)(t.id),g=(0,c.e)(),f=(0,l.E)(),b=(0,h.L)();if(!i)return null;const{id:y,textParser:S,title:E,description:x,icon:C}=t,D=y===f,A=i.info.type===n.S.FloorplanOnly?"floorplan":"dollhouse",w=g?(0,d.x8)(E,g):E,L=g?(0,d.x8)(x,g):x,I=(0,s.jsxs)("div",Object.assign({className:"item-details"},{children:[(0,s.jsxs)("div",Object.assign({className:"item-header"},{children:[(0,s.jsx)(m.L,{text:w||"",textParser:S,markers:d.S8}),(0,s.jsx)("div",Object.assign({className:"list-item-decal"},{children:(0,s.jsx)(u.I,{name:A})}))]})),x&&(0,s.jsx)("div",Object.assign({className:"item-description"},{children:(0,s.jsx)(m.L,{text:L,textParser:S,markers:d.S8})}))]}));return(0,s.jsx)(p.c,{id:y,className:"search-result-item",title:I,active:D,disabled:!t.enabled,onClick:async()=>{e.trackGuiEvent("search_item_measurement_click",{tool:b}),t.onSelect()},badge:(0,s.jsx)(v.E,{iconClass:C})},y)}},32981:(t,e,i)=>{"use strict";i.d(e,{Qm:()=>r,SK:()=>o,Ve:()=>l,_w:()=>n,jF:()=>a});var s=i(13686);class o extends s.E{constructor(t,e,i,s,o=0){super(),this.position=t,this.buttons=e,this.device=i,this.ctrlKey=s,this.pointerId=o}}class a extends s.E{constructor(t,e,i,s,o,a=0){super(),this.ctrlKey=!1,this.position=t,this.clientPosition=s,this.delta=e,this.buttons=i,this.device=o,this.pointerId=a}}class n extends s.E{constructor(t,e,i,s,o,a,n=0){super(),this.ctrlKey=!1,this.position=t,this.delta=e,this.buttons=i,this.timeSinceLastMove=s,this.fullDelta=o,this.device=a,this.pointerId=n}}class r extends s.E{constructor(t,e){super(),this.position=t,this.pointer=e}}class l extends s.E{constructor(t,e,i,s){super(),this.position=t,this.startPosition=e,this.fullDelta=i,this.pointer=s}}},33518:(t,e,i)=>{"use strict";i.d(e,{k:()=>o});var s=i(42399);class o extends s.T{constructor(t,e,i){super(),this.key=t,this.state=e,this.modifiers=i}}},75650:(t,e,i)=>{"use strict";i.d(e,{$3:()=>n,CD:()=>a});var s=i(42399);class o extends s.T{}class a extends o{constructor(t,e,i,s,o,a,n){super(),this.id=t,this.position=e,this.clientPosition=i,this.button=s,this.down=o,this.device=a,this.nativeEvent=n}}class n extends o{constructor(t,e,i,s,o,a){super(),this.id=t,this.position=e,this.clientPosition=i,this.buttons=s,this.device=o,this.nativeEvent=a}}},69467:(t,e,i)=>{"use strict";i.d(e,{JU:()=>r,rn:()=>a,tz:()=>n});var s=i(61693),o=i(68909);const a=30,n=1;class r extends s.v{constructor(){super(...arguments),this.position=new o.Vector3,this.floorId="",this.sid="",this.layerId="",this.text="",this.visible=!1,this.roomId=void 0,this.created=new Date,this.modified=new Date,this.version="3.1"}copy(t){return this.floorId=t.floorId,this.roomId=t.roomId,this.sid=t.sid,this.text=t.text,this.visible=t.visible,this.roomId=t.roomId,this.created=t.created,this.modified=t.modified,this.position.copy(t.position),this.version=t.version,this.commit(),this}}},30593:(t,e,i)=>{"use strict";i.d(e,{D:()=>r,M:()=>l});var s=i(68909),o=i(83916),a=i(7517),n=i(18618);const r={OpacityMaxDefault:1,OpacityMaxNonSelected:.4};class l extends s.Object3D{constructor(t){super(),this.text=t,this.maxOpacity=1,this.labelAnim=new o.z(0),this.filtered=!1,this.hidden=!1,this.selectState={active:!1,on:()=>{},off:()=>{}},this.validState={active:!0,on:()=>{const t=this.hoverState.active?n.RD.ColorHovered:n.RD.ColorDefault;this.text.setColor(t)},off:()=>{this.text.setColor(n.RD.ColorInvalid)}},this.hoverState={active:!1,on:()=>{this.validState.active&&this.text.setColor(n.RD.ColorHovered)},off:()=>{this.validState.active&&this.text.setColor(n.RD.ColorDefault)}},this.add(t)}use(t){this.data=t,this.userData.sid=t.sid,this.userData.data=t,this.text.use(this),this.labelUpdate(t.position,new s.Quaternion,"")}getId(){return this.data.sid}labelVisible(){return!this.filtered&&!this.hidden}updatePose(t,e){return this.labelUpdate(t,e,this.data.text),this}setMaxOpacity(t){this.maxOpacity=t,this.toggleLabel(this.labelVisible())}free(){this.labelAnim.value>0&&this.toggleLabel(!1)}tickAnimations(t){return this.animateLabelOpacity(.5*t),this}toggleLabel(t){this.hidden=!t,this.updateOpacity()}isHidden(){return this.hidden}toggleFiltered(t){t!==this.filtered&&(this.filtered=t,this.updateOpacity())}updateOpacity(){const t=this.labelVisible()?this.maxOpacity:0;this.labelAnim.endValue!==t&&this.labelAnim.modifyAnimation(this.labelAnim.value,t,a.Q.FADE_DURATION)}animateLabelOpacity(t){const e=this.labelAnim.tick(t);Math.min(e,this.maxOpacity)!==this.text.opacity&&(this.text.opacity=e)}labelUpdate(t,e,i){this.text.position.copy(t),this.text.quaternion.copy(e),this.text.text=i}billboard(t,e,i,s,o,a,n){this.text.scaleBillboard(t,e,i,s,o,a,n)}}},18618:(t,e,i)=>{"use strict";i.d(e,{F5:()=>l,RD:()=>n,Z3:()=>r});var s=i(81507),o=i(68909),a=i(84252);const n={ColorDefault:a.V.WHITE.clone(),ColorHovered:a.V.MP_BRAND.clone(),ColorInvalid:new o.Color(16750933)};class r extends s.QM{use(t){this.userData.sid=t.data.sid,this.collider.data=t.data,this.collider.name=t.data.text,this.collider.labelMesh=t}}class l extends o.Mesh{constructor(){super(...arguments),this.hitTest=(()=>{const t=new o.Matrix4,e=new o.Ray,i=new o.Plane(new o.Vector3(0,0,-1)),s=new o.Vector3;return(o,a)=>{if(t.copy(this.matrixWorld).invert(),e.copy(o.ray).applyMatrix4(t),e.intersectPlane(i,s)){const t=this.scale.x/this.scale.y;let e=.5;t<1.5&&(e=1/t),Math.abs(s.x)<=e&&Math.abs(s.y)<=.75&&(s.applyMatrix4(this.matrixWorld),a.push({distance:o.ray.origin.distanceTo(s),point:s.clone(),object:this}))}}})()}labelVisible(){return!(!this.labelMesh||!this.labelMesh.labelVisible())}getId(){if(!this.data)throw new Error("LabelInputCollider used before configure");return this.data.sid}raycast(t,e){if(!this.labelVisible())return;if(this.material.depthTest)return void this.hitTest(t,e);const i=this.material.depthTest?e:[];this.hitTest(t,i),i.length>0&&(i[0].distance/=1e4,e.push(i[0]))}}},7517:(t,e,i)=>{"use strict";i.d(e,{Q:()=>o,n:()=>s});const s=30,o={LABEL_SIZE:0,FADE_DURATION:200}},80253:(t,e,i)=>{"use strict";i.d(e,{ES:()=>o,EX:()=>s,y4:()=>h});var s,o,a=i(68909),n=i(4071),r=i(12183),l=i(43998);!function(t){t[t.PIXELS=0]="PIXELS",t[t.METERS=1]="METERS"}(s||(s={})),function(t){t[t.NONE=0]="NONE",t[t.FADE_IN=1]="FADE_IN",t[t.FADE_OUT=-1]="FADE_OUT"}(o||(o={}));class h extends a.Mesh{constructor(t,e,i){var o,h,c,d,u,p,v,m;const g=new Float32Array([-9999,-9999,-9999,9999,9999,9999,-9999,-9999,-9999,9999,9999,9999,9999,9999,9999,-9999,-9999,-9999]),f=new Float32Array([1,1,0,0,-1,-1]),b=new Float32Array([0,1,0,1,0,1]),y=new a.InstancedBufferGeometry;y.setAttribute("position",new a.Float32BufferAttribute(g,3)),y.setAttribute("offsetDirection",new a.Float32BufferAttribute(f,1)),y.setAttribute("t",new a.Float32BufferAttribute(b,1)),y.setIndex([0,1,3,2,0,3,2,3,5,4,2,5]);const S={},E={};(null==e?void 0:e.dashUnits)===s.METERS&&(S.WORLDSPACE_DASH=!0,E.derivatives=!0);const x=null==e?void 0:e.fadeDistanceFromCamera;null!=x&&(S.FADE_DISTANCE_FROM_CAMERA=x.toFixed(2));const C=null==e?void 0:e.fadeDepth,D=null==e?void 0:e.fadeDepthTexture;null!=C&&null!=D&&(S.FADE_DEPTH=C.toFixed(3));super(y,new a.ShaderMaterial({uniforms:a.UniformsUtils.clone(n.i.screenline.uniforms),side:a.DoubleSide,vertexShader:n.i.screenline.vertexShader,fragmentShader:n.i.screenline.fragmentShader,transparent:!0,depthTest:e.depthTest,depthWrite:e.depthWrite,depthFunc:e.depthFunc,stencilWrite:null!==(o=e.stencilWrite)&&void 0!==o&&o,stencilFunc:null!==(h=e.stencilFunc)&&void 0!==h?h:a.AlwaysStencilFunc,stencilRef:null!==(c=e.stencilRef)&&void 0!==c?c:0,stencilWriteMask:null!==(d=e.stencilWriteMask)&&void 0!==d?d:255,stencilFuncMask:null!==(u=e.stencilFuncMask)&&void 0!==u?u:255,stencilFail:null!==(p=e.stencilFail)&&void 0!==p?p:a.KeepStencilOp,stencilZFail:null!==(v=e.stencilZFail)&&void 0!==v?v:a.KeepStencilOp,stencilZPass:null!==(m=e.stencilZPass)&&void 0!==m?m:a.KeepStencilOp,defines:S,extensions:E})),this.cameraPose=i,this.transitionStartTime=0,this.transitionDuration=0,this.updateEndpoints(t),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.renderOrder=r.X.lines,this.transitionDuration=e.transitionDuration||300,this.onBeforeRender=t=>{t.getSize(this.material.uniforms.screenSize.value),this.material.uniforms.pixelRatio.value=t.getPixelRatio(),null!=this.cameraPose&&(this.material.uniforms.cameraPos.value.copy(this.cameraPose.position),this.material.uniforms.transitionProgress.value=(0,l.qE)(Math.abs(performance.now()-this.transitionStartTime)/this.transitionDuration,0,1))},this.material.uniforms.dashed.value=+e.dashed,this.material.uniforms.dashSize.value=e.dashSize,this.material.uniforms.gapSize.value=e.gapSize,this.material.uniforms.lineWidth.value=e.lineWidth,this.material.uniforms.color.value.copy(e.color),this.material.uniforms.globalOpacity.value=e.globalOpacity,this.material.uniforms.depthTex.value=null==D?void 0:D.texture,this.material.uniforms.transitionType.value=e.transitionType||0,this.frustumCulled=!1,this.matrixAutoUpdate=!1}updateEndpoints(t){var e;3*t.length!==(null===(e=this.start)||void 0===e?void 0:e.length)&&(this.geometry.dispose(),this.start=new Float32Array(3*t.length),this.startAttrib=new a.InstancedBufferAttribute(this.start,3),this.geometry.setAttribute("start",this.startAttrib),this.end=new Float32Array(3*t.length),this.endAttrib=new a.InstancedBufferAttribute(this.end,3),this.geometry.setAttribute("end",this.endAttrib),this.opacity=new Float32Array(t.length),this.opacityAttrib=new a.InstancedBufferAttribute(this.opacity,1),this.geometry.setAttribute("opacity",this.opacityAttrib));for(let e=0;e<t.length;e++){const i=t[e].points,s=t[e].opacity;i[0].toArray(this.start,3*e),i[1].toArray(this.end,3*e),this.opacity[e]=null!=s?s:1}this.startAttrib.needsUpdate=!0,this.endAttrib.needsUpdate=!0,this.opacityAttrib.needsUpdate=!0}setVisibilityAt(t,e){const i=e?1:0;this.opacity[t]=i,this.opacityAttrib.needsUpdate=!0}globalOpacity(t){this.material.uniforms.globalOpacity.value=t}color(t){this.material.uniforms.color.value.copy(t)}lineWidth(t){this.material.uniforms.lineWidth.value=t}startTransition(t=o.FADE_IN){this.material.uniforms.transitionType.value=t,this.material.uniforms.transitionProgress.value=0,this.transitionStartTime=performance.now()}}},79971:(t,e,i)=>{"use strict";i.d(e,{CW:()=>c,yp:()=>u});var s=i(68909),o=i(75673),a=i(39591);const n=new s.Vector2,r=new s.Vector3,l=new s.Vector2,h=new s.Vector2,c=(t,e,i)=>{const s=((t,e,i)=>((0,a.bz)(i,t,l),(0,a.bz)(i,e,h),{pixelDistance:l.distanceTo(h),startScreenPosition:l,endScreenPosition:h}))(t,e,i),o=((t,e,i)=>(r.copy(t).add(e).multiplyScalar(.5),(0,a.bz)(i,r,n),n))(t,e,i);return{screenPosition:o,rotation:d(l,h),pixelDistance:s.pixelDistance,startScreenPosition:s.startScreenPosition,endScreenPosition:s.endScreenPosition}},d=(t,e)=>{const i=t.y-e.y,s=t.x-e.x;let a=Math.atan2(i,s)*o.tm;return a=a>=90||a<=-90?a+180:a,a},u=(t,e=10,i=40)=>({width:Math.max(9*Math.max(t,2)+e,i),height:18+e})},52964:(t,e,i)=>{"use strict";i.d(e,{k:()=>o});var s=i(18268);class o extends s.u{constructor(t,e=""){super(),this.payload={sid:t,text:e}}}o.id="RENAME_MEASUREMENT"},75450:(t,e,i)=>{"use strict";i.d(e,{k:()=>o});var s=i(18268);class o extends s.u{constructor(t,...e){super(),this.payload={sids:e,visible:t}}}o.id="MEASUREMENTS_SET_VISIBILITY"},89643:(t,e,i)=>{"use strict";i.d(e,{Yp:()=>h,ZP:()=>c,_U:()=>o,_s:()=>u,d:()=>d,eT:()=>a,gy:()=>n,i7:()=>r,rS:()=>l});var s=i(27786);const o=.01,a=.001,n={highResThreshold:1081,desktopSize:192,desktopSizeHighRes:320,mobileSize:128},r={smoothness:.4,perspective:{fov:40,thresholdClose:1,thresholdFar:8,offsetClose:.25,offsetFar:.5,scale:1},ortho:{fov:5,thresholdClose:5,thresholdFar:20,offsetClose:15,offsetFar:30,scale:4}},l={desktop:s.tx.Edges,floorplan:s.tx.Axes,mobile:s.tx.Edges,alt:s.tx.Free,shift:s.tx.PlanarAxes,shiftAlt:s.tx.EdgesAndPlanarAxes,disabled:s.tx.Free},h={mobile:.15,desktop:.1},c={SCALE:.1,SCALE_NDC:.5,SCALE_ASPECT:.035,SCALE_DISTANCE:.025},d="measurements",u=24},30498:(t,e,i)=>{"use strict";var s;i.d(e,{S:()=>s}),function(t){t[t.FloorplanOnly=0]="FloorplanOnly",t[t.ThreeD=1]="ThreeD"}(s||(s={}))},90302:(t,e,i)=>{"use strict";i.d(e,{aV:()=>n,c$:()=>a,f_:()=>r});var s=i(94221);const o=t=>t instanceof s.r,a=t=>o(t),n=t=>o(t)&&t.raycastEnabled&&t.visible,r=t=>{let e=t.visible;e&&t.traverseAncestors((t=>{e&&(e=t.visible)}));return!a(t)&&e||n(t)}},20804:(t,e,i)=>{"use strict";i.d(e,{PO:()=>o,m2:()=>a});var s=i(10691);const o=t=>!!t&&t instanceof s.B,a={hasMeshGroup:t=>"object"==typeof t&&!!t&&"meshGroup"in t,hasMeshSubgroup:t=>"object"==typeof t&&!!t&&"meshSubgroup"in t,isRoomMesh:o,isVisibleRoomMesh:t=>o(t)&&t.raycastEnabled&&t.visible}},64367:(t,e,i)=>{"use strict";i.d(e,{y:()=>p});var s=i(84252),o=i(58968),a=i(40888),n=i(79953),r=i(68909),l=i(24250),h=i(14938),c=i(30745),d=i(11827);const u={baseState:{innerColor:s.V.WHITE,outerColor:s.V.WHITE,opacity:1},hoverState:{innerColor:s.V.WHITE,outerColor:s.V.NEPTUNE,opacity:1},selectState:{innerColor:s.V.WHITE,outerColor:s.V.NEPTUNE,opacity:1},dimState:{innerColor:s.V.WHITE,outerColor:s.V.WHITE,opacity:.5},highlightState:{innerColor:s.V.WHITE,outerColor:s.V.NEPTUNE,opacity:1}};class p extends h.r{constructor(t,e,i,h,d,p){super(t,e,new r.BufferGeometry,new r.ShaderMaterial,i),this.floorId=e,this.instanceBuffer=h,this.lineLabel=d,this.isAddState=p,this.line3=new r.Line3(new r.Vector3,new r.Vector3),this.widthCache=.1,this.currOutlineColor=new r.Color,this.currInnerColor=new r.Color,this.updateMaterial=()=>{super.updateMaterial(),this.targetColorScheme!==u.highlightState||this.isAddState()||(this.targetColorScheme=u.baseState),this.prevColorState.innerColor.copy(this.currInnerColor),this.prevColorState.outerColor.copy(this.currOutlineColor),this.prevColorState.opacity=this.opacity,this.animation.modifyAnimation(0,1,c.JT,n.WD),this.lineLabel.setVisible(this.selectState.active||this.highlightState.active||this.hoverState.active)},this.onEdgePositionChanged=(()=>{const t=new r.Vector3,e=new r.Vector3,i=new r.Vector3,s=new r.Vector3,a=new r.Vector3,n=new r.Vector3,l=new r.Vector3;return(r,h,c)=>{const d=r.getWall(this.roomBoundsId);d.from.getVec3(t),d.to.getVec3(e),d.getBiasAdjustmentVec(l),i.set(t.x,t.y+h,t.z),s.set(e.x,e.y+h,e.z),a.addVectors(i,l),n.addVectors(s,l),this.line3.start.copy(a),this.line3.end.copy(n),this.widthCache=d.width,this.lineLabel.updateDimensions(a,n,d.width,c);const u=(0,o.A)(d,r);this.instanceBuffer.setGeometryForInstance(this,h,a.x,a.z,n.x,n.z,d.width,i.x,i.z,s.x,s.z,u)}})(),this.instanceBuffer.allocInstance(this),this.renderOrder=l.S.EDGE,this.colors=u,this.animation.onChanged((()=>{const t=this.prevColorState,e=this.targetColorScheme;this.currOutlineColor.lerpColors(t.outerColor,e.outerColor,this.animation.value),this.currInnerColor.lerpColors(t.innerColor,e.innerColor,this.animation.value);const i=(0,a.C)(t.opacity,e.opacity,this.animation.value);this.opacity=i,this.instanceBuffer.setColorsForInstance(this,this.currOutlineColor,this.currInnerColor),this.instanceBuffer.setOpacityForInstance(this,this.opacity)})),this.instanceBuffer.setColorsForInstance(this,s.V.WHITE,s.V.WHITE),this.instanceBuffer.setOpacityForInstance(this,1),this.matrixAutoUpdate=!1,this.frustumCulled=!1}raycast(t,e){(0,d.a)(this.line3.start,this.line3.end,this.widthCache,this.cameraData,this,t,e)}tickAnimations(t){super.tickAnimations(t),this.lineLabel.tickAnimations(t)}setLabelVisible(t){this.lineLabel.setVisible(t)}dispose(){super.dispose(),this.lineLabel.dispose(),this.instanceBuffer.removeInstance(this)}onRender(t,e){super.onRender(t,e),this.lineLabel.update()}}},12260:(t,e,i)=>{"use strict";i.d(e,{L:()=>v});var s=i(68909),o=i(24250),a=i(14938),n=i(84252),r=i(40888),l=i(79953),h=i(30745),c=i(90280),d=i(48071);const u={baseState:{opacity:1,innerColor:n.V.MIRROR,outerColor:n.V.PORTAL},hoverState:{opacity:1,innerColor:n.V.MIRROR,outerColor:n.V.PORTAL},selectState:{opacity:1,innerColor:n.V.MP_BRAND,outerColor:n.V.WHITE},dimState:{opacity:1,innerColor:n.V.MIRROR,outerColor:n.V.PORTAL}},p=new s.Plane;class v extends a.r{constructor(t,e,i,a){super(t,e,new s.BufferGeometry,new s.ShaderMaterial,i),this.floorId=e,this.instanceBuffer=a,this.targetRadius=.3,this.prevRadius=.3,this.currOuterColor=u.baseState.outerColor.clone(),this.currInnerColor=u.baseState.innerColor.clone(),this.currRadius=h.m7,this.renderOrder=o.S.NODE,this.colors=u,this.animation.onChanged((()=>this.onAnimationChange())),this.instanceBuffer.allocInstance(this),this.instanceBuffer.setColorsForInstance(this,this.currOuterColor,this.currInnerColor),this.instanceBuffer.setRadiusForInstance(this,this.currRadius),this.instanceBuffer.setOpacityForInstance(this,1)}onAnimationChange(){const t=this.prevColorState,e=this.targetColorScheme;this.currOuterColor.lerpColors(t.outerColor,e.outerColor,this.animation.value),this.currInnerColor.lerpColors(t.innerColor,e.innerColor,this.animation.value),this.instanceBuffer.setColorsForInstance(this,this.currOuterColor,this.currInnerColor),this.opacity=(0,r.C)(t.opacity,e.opacity,this.animation.value),this.instanceBuffer.setOpacityForInstance(this,this.opacity);const i=(0,r.C)(this.prevRadius,this.targetRadius,this.animation.value);this.instanceBuffer.setRadiusForInstance(this,i)}onRender(t,e){super.onRender(t,e)}raycast(t,e){p.setFromNormalAndCoplanarPoint(d.B1.UP,this.position);const i=t.ray.intersectPlane(p,new s.Vector3);if(i){const s=t.ray.origin.distanceTo(this.position),o=(0,c.ff)(s,this.cameraData.pose.projection.asThreeMatrix4(),this.cameraData.width),a=h.ub*o;i.distanceTo(this.position)<h.m7+a&&e.push({point:i,normal:d.B1.UP.clone(),distance:i.distanceTo(t.ray.origin),object:this})}}updateMaterial(){this.prevRadius=this.currRadius,this.targetRadius=h.m7+(this.hoverState.active?h.xX:0)+(this.selectState.active?h.xX:0),super.updateMaterial(),this.prevColorState.innerColor.copy(this.currInnerColor),this.prevColorState.outerColor.copy(this.currOuterColor),this.prevColorState.opacity=this.opacity,this.animation.modifyAnimation(0,1,h.JT,l.WD)}updatePosition(t){this.position.copy(t),this.instanceBuffer.setPositionForInstance(this,t)}dispose(){this.instanceBuffer.removeInstance(this),super.dispose()}}},96582:(t,e,i)=>{"use strict";i.d(e,{D9:()=>p,V1:()=>u,iM:()=>m,jP:()=>v});var s=i(84252),o=i(79953),a=i(68909),n=i(12260),r=i(24250),l=i(14938),h=(i(41799),i(28293)),c=i(30745),d=i(11827);a.ShaderMaterial;class u extends l.r{constructor(t,e,i,o,n,l,c){super(t,e,new a.BufferGeometry,new a.ShaderMaterial,i),this.floorId=e,this.cameraData=i,this.roomBoundViewData=o,this.instanceBufferOpening=l,this.instanceBufferOpeningStencil=c,this.start=new a.Vector3,this.end=new a.Vector3,this.width=0,this.outlineColor=s.V.WHITE.clone(),this.onEdgePositionChanged=(()=>{const t=new a.Vector3,e=new a.Vector3;return(i,s,o,a)=>{this.start.copy(i),this.end.copy(s),this.width=o,t.subVectors(s,i);const n=t.length(),r=o;e.set(n,.05,r),this.instanceBufferOpening.setScaleForInstance(this,e),this.instanceBufferOpeningStencil.setScaleForInstance(this,e);const l=Math.atan2(s.x-i.x,s.z-i.z)+Math.PI/2;this.instanceBufferOpening.setRotationForInstance(this,l),this.instanceBufferOpeningStencil.setRotationForInstance(this,l);const c=t.addVectors(s,i).multiplyScalar(.5);this.instanceBufferOpening.setPositionForInstance(this,c),this.instanceBufferOpeningStencil.setPositionForInstance(this,c),this.startHandle.updatePosition(i),this.endHandle.updatePosition(s);const d=a===h.v.DOOR;this.instanceBufferOpening.setIsDoorForInstance(this,d),this.instanceBufferOpeningStencil.setIsDoorForInstance(this,d)}})(),this.renderOrder=r.S.OPENING_LINES,this.startHandle=new v(t,e,i,n,this),this.endHandle=new m(t,e,i,n,this),this.instanceBufferOpening.allocInstance(this),this.instanceBufferOpeningStencil.allocInstance(this),this.instanceBufferOpening.setColorForInstance(this,this.outlineColor),this.instanceBufferOpeningStencil.setColorForInstance(this,this.outlineColor),this.animation.onChanged((()=>{this.outlineColor.lerpColors(s.V.WHITE,s.V.NEPTUNE,this.animation.value),this.instanceBufferOpening.setColorForInstance(this,this.outlineColor),this.instanceBufferOpeningStencil.setColorForInstance(this,this.outlineColor)}))}onRender(t,e){super.onRender(t,e),this.visible=this.pitchFactor<1&&this.roomBoundViewData.roomWallsVisible,this.startHandle.onRender(t,e),this.endHandle.onRender(t,e)}updateMaterial(){const t=this.selectState.active||this.hoverState.active||this.highlightState.active;this.animation.modifyAnimation(this.animation.value,t?1:0,c.JT,o.WD)}tickAnimations(t){super.tickAnimations(t),this.startHandle.tickAnimations(t),this.endHandle.tickAnimations(t)}raycast(t,e){(0,d.a)(this.start,this.end,this.width,this.cameraData,this,t,e)}dispose(){super.dispose(),this.startHandle.dispose(),this.endHandle.dispose(),this.instanceBufferOpening.removeInstance(this),this.instanceBufferOpeningStencil.removeInstance(this)}}class p extends n.L{constructor(t,e,i,s,o){super(t,e,i,s),this.floorId=e,this.parentOpeningView=o}}class v extends p{}class m extends p{}},24250:(t,e,i)=>{"use strict";i.d(e,{S:()=>s,j:()=>o});var s,o,a=i(12183);!function(t){t[t.BASE=a.X.roomBounds]="BASE",t[t.OPENING_STENCIL=a.X.roomBounds+1]="OPENING_STENCIL",t[t.EDGE_STENCIL=a.X.roomBounds+2]="EDGE_STENCIL",t[t.ROOM=a.X.roomBounds+3]="ROOM",t[t.EDGE=a.X.roomBounds+4]="EDGE",t[t.OPENING_LINES=a.X.roomBounds+5]="OPENING_LINES",t[t.NODE=a.X.roomBounds+6]="NODE"}(s||(s={})),function(t){t[t.OPENINGS=0]="OPENINGS",t[t.EDGE=1]="EDGE"}(o||(o={}))},99031:(t,e,i)=>{"use strict";i.d(e,{y:()=>D});var s=i(84252),o=i(79971),a=i(40888),n=i(79953),r=i(68909),l=i(24250),h=i(14938),c=i(30745),d=i(41799),u=i(59503),p=i(80253),v=i(39591),m=i(48071),g=i(45138),f=i.n(g),b=i(68216),y=i.n(b);const S={uniforms:{screenSize:{value:new r.Vector2(0,0)},color:{value:new r.Vector3(1,1,1)},radius:{value:10},opacity:{value:1}},vertexShader:f(),fragmentShader:y()};class E extends r.Mesh{constructor(t,e){const i=new Float32Array([-9999,-9999,-9999,9999,9999,9999,-9999,-9999,-9999,9999,9999,9999]),s=new Float32Array([-1,1,1,1,1,-1,-1,-1]),o=new r.InstancedBufferGeometry;o.setAttribute("position",new r.Float32BufferAttribute(i,3)),o.setAttribute("offsetDirection",new r.Float32BufferAttribute(s,2)),o.setIndex([0,3,1,1,3,2]);super(o,new r.ShaderMaterial({uniforms:r.UniformsUtils.clone(S.uniforms),vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1})),this.setPositions(t),this.setMaterialParams(e),this.frustumCulled=!1,this.onBeforeRender=t=>{t.getSize(this.material.uniforms.screenSize.value)}}setMaterialParams(t){null!=t.color&&this.material.uniforms.color.value.copy(t.color),null!=t.opacity&&(this.material.uniforms.opacity.value=t.opacity),null!=t.radius&&(this.material.uniforms.radius.value=t.radius)}setPositions(t){this.geometry.dispose();const e=new Float32Array(3*t.length);for(let i=0;i<t.length;i++)e[3*i]=t[i].position.x,e[3*i+1]=t[i].position.y,e[3*i+2]=t[i].position.z;const i=new r.InstancedBufferAttribute(e,3);this.geometry.setAttribute("center",i),i.needsUpdate=!0}}class x extends r.Object3D{constructor(t,e,i,o,a,n,l,h,d,u){super(),this.labelManager=o,this.floorId=a,this.units=n,this.cameraPoseData=l,this.roomBoundViewData=h,this.depthMesh=u,this.labels=[],this.userIsInside=!1,this.lines=[],this.datumLines=[],this.roofLinesOffset=0,this.tempUp=new r.Vector3,this.linesInScene=!1,this.labelsVisible=!1,this.removeLineTimeout=null,this.solidOutlines=new p.y4(this.lines,{dashed:!1,dashSize:1,gapSize:1,lineWidth:.5,color:s.V.WHITE,dashUnits:p.EX.METERS,depthWrite:!1,depthTest:!1,depthFunc:r.LessDepth,globalOpacity:1,fadeDistanceFromCamera:c.GG,fadeDepth:c.Zc,fadeDepthTexture:d,transitionType:p.ES.FADE_IN,transitionDuration:c.rH},this.cameraPoseData),this.solidDatums=new p.y4(this.lines,{dashed:!0,dashSize:10,gapSize:4,lineWidth:1,color:s.V.WHITE,dashUnits:p.EX.PIXELS,depthWrite:!1,depthTest:!0,depthFunc:r.LessDepth,globalOpacity:1,transitionType:p.ES.FADE_IN,transitionDuration:c.rH},this.cameraPoseData),this.fadedDatums=new p.y4(this.lines,{dashed:!0,dashSize:10,gapSize:4,lineWidth:1,color:s.V.WHITE,dashUnits:p.EX.PIXELS,depthWrite:!1,depthTest:!0,depthFunc:r.GreaterDepth,globalOpacity:.4,transitionType:p.ES.FADE_IN,transitionDuration:c.rH},this.cameraPoseData),this.datumCircles=new E([],{radius:5}),this.linesInScene=!1,this.updateEndpoints(t,e,i),this.updateLabelEndpoints()}updateUnits(t){this.units=t,this.updateLabelEndpoints()}updateEndpoints(t,e,i){this.datumLines=t.map((t=>({points:t.points,opacity:1})));const s=[],o=[];if(null!=i){this.tempUp.copy(m.B1.UP).multiplyScalar(i);for(const t of e){const e=(new r.Vector3).copy(t.points[0]);e.y+=i,s.push({points:[t.points[0],e]}),o.push({points:[t.points[0].clone().add(this.tempUp),t.points[1].clone().add(this.tempUp)]})}}this.roofLinesOffset=e.length+s.length,this.lines=e.concat(s,o).map((t=>({points:t.points,opacity:1}))),this.solidOutlines.updateEndpoints(this.lines),this.solidDatums.updateEndpoints(this.datumLines),this.fadedDatums.updateEndpoints(this.datumLines);const a=[];for(const t of this.datumLines)for(const e of t.points)a.push({position:e});this.datumCircles.setPositions(a),this.updateLabelEndpoints()}onRender(t){var e,i;const s=1*t,o=.4*t;(s>.1||o>.1)&&this.userIsInside&&this.roomBoundViewData.roomDimensionsVisible?this.addLinesToScene():this.removeLinesFromScene(),this.solidOutlines.globalOpacity(s),this.solidDatums.globalOpacity(s),this.fadedDatums.globalOpacity(o),this.datumCircles.setMaterialParams({opacity:s});const a=this.userIsInside&&this.roomBoundViewData.roomDimensionsVisible;if(a){for(const t of this.labels)t.setVisible(!0);null===(e=this.datumLabel)||void 0===e||e.setVisible(!0)}else{for(const t of this.labels)t.setVisible(!1);null===(i=this.datumLabel)||void 0===i||i.setVisible(!1)}this.labelsVisible!==a&&(this.labelManager.needsImmediateCollsisionDetection(),this.labelsVisible=a)}addLinesToScene(){this.linesInScene||(this.add(this.solidOutlines),this.solidOutlines.startTransition(),this.add(this.solidDatums),this.solidDatums.startTransition(),this.add(this.fadedDatums),this.fadedDatums.startTransition(),this.add(this.datumCircles),this.linesInScene=!0,this.depthMesh.visible=!0,this.removeLineTimeout&&(window.clearTimeout(this.removeLineTimeout),this.removeLineTimeout=null))}removeLinesFromScene(){if(this.linesInScene){const t=()=>{this.remove(this.solidOutlines),this.remove(this.solidDatums),this.remove(this.fadedDatums),this.remove(this.datumCircles),this.depthMesh.visible=!1,this.removeLineTimeout=null};null!=this.removeLineTimeout&&(window.clearTimeout(this.removeLineTimeout),this.removeLineTimeout=null),this.solidOutlines.startTransition(p.ES.FADE_OUT),this.solidDatums.startTransition(p.ES.FADE_OUT),this.fadedDatums.startTransition(p.ES.FADE_OUT),this.removeLineTimeout=window.setTimeout(t,c.rH),this.linesInScene=!1}}setUserIsInsideRoom(t){this.userIsInside=t}updateLabelEndpoints(){var t;if(this.roofLinesOffset!==this.labels.length){const t=this.roofLinesOffset-this.labels.length;t>0?this.createLabels(t,this.labels):t<0&&this.deleteLabels(t,this.labels)}for(let t=0;t<this.roofLinesOffset;t++){const e=this.lines[t];this.labels[t].updateDimensions(e.points[0],e.points[1],0,this.units),this.labels[t].isVertical(e.points[0],e.points[1])&&(this.labels[t].labelGroupId="inside_height_label")}this.datumLines.length>0&&(null==this.datumLabel&&(this.datumLabel=this.labelManager.createDatumLabel(this.floorId,this),this.datumLabel.setVisible(!1)),null===(t=this.datumLabel)||void 0===t||t.updateDimensions(this.datumLines[0].points[0],this.datumLines[0].points[1],0,this.units))}createLabels(t,e){for(let i=0;i<t;i++){const t=this.labelManager.createInsideLabel(this.floorId,this);t.setVisible(!1),e.push(t)}}deleteLabels(t,e){for(let i=0;i<t;i++){const t=e.pop();null==t||t.dispose()}}}const C={baseState:{innerColor:s.V.LENS_GRAY,outerColor:s.V.WHITE,opacity:0},hoverState:{innerColor:s.V.WHITE,outerColor:s.V.WHITE,opacity:.25},selectState:{innerColor:s.V.NEPTUNE,outerColor:s.V.WHITE,opacity:0},dimState:{innerColor:s.V.LENS_GRAY,outerColor:s.V.WHITE,opacity:.5}};class D extends h.r{constructor(t,e,i,n,h,c,u,p,m,g){const f=D.getGeoFromRoom(t,i),b=new r.MeshBasicMaterial({color:s.V.LENS_GRAY,depthTest:!1,side:r.DoubleSide,transparent:!0,opacity:0,blending:r.NormalBlending,blendEquation:r.AddEquation,blendSrc:r.SrcAlphaFactor,blendDst:r.DstColorFactor,stencilRef:65535,stencilFuncMask:1<<l.j.EDGE,stencilFail:r.KeepStencilOp,stencilZFail:r.KeepStencilOp,stencilZPass:r.KeepStencilOp,stencilFunc:r.GreaterStencilFunc,stencilWrite:!0});super(t.id,e,f,b,n),this.floorId=e,this.baseHeight=i,this.roomBoundViewData=c,this.labelManager=u,this.units=p,this.calcBaseHeight=m,this.caretsInstanceBuffer=g,this.currRoomLabelRadius=.5,this.potentialLabels=[],this.perimeterLabels=[],this.hideMaterial=new r.ShaderMaterial({vertexShader:d.Om.vertexShader,fragmentShader:d.Om.fragmentShader,uniforms:r.UniformsUtils.clone(d.Om.uniforms),depthTest:!1,side:r.DoubleSide,transparent:!0}),this.depthMaterial=new r.ShaderMaterial({vertexShader:d.Tx.vertexShader,fragmentShader:d.Tx.fragmentShader,uniforms:r.UniformsUtils.clone(d.Tx.uniforms),depthTest:!0,side:r.FrontSide}),this.perimeterLabelsVisible=!1,this.fullLabelVisible=!1,this.hoverTimer=null,this.labelHovered=!1,this.heightLines=new r.Group,this.heightLinesInScene=!1,this.heightLabels=[],this.insideNess=1,this.getLabelRadiusPx=t=>{const e=t.split("\n"),i=e.reduce(((t,e)=>Math.max(t,e.length)),0),s=(0,o.yp)(i,0,0),a=.5*s.width,n=.5*s.height*e.length;return Math.max(a,n)},this.worldRadiusToScreen=(()=>{const t=[new r.Vector3(1,0,0),new r.Vector3(-1,0,0),new r.Vector3(0,0,1),new r.Vector3(0,0,-1)],e=new r.Vector3,i=new r.Vector2,s=new r.Vector2,o=new r.Vector3;return(a,n,r)=>{let l=Number.MAX_SAFE_INTEGER;(0,v.bz)(this.cameraData,a,i,o),r.copy(i);for(const r of t){e.copy(a).addScaledVector(r,n),(0,v.bz)(this.cameraData,e,s,o);const t=i.distanceTo(s);t<l&&(l=t)}return l}})(),this.updateCarets=(()=>{const t=[new r.Vector2,new r.Vector2,new r.Vector2,new r.Vector2];return()=>{const e=this.cameraData.metersPerPx(),i=this.room.length/e,s=this.room.width/e,o=this.roomLabel.getSize(),a=o.width+2>i,n=o.height+2>s,r=this.fullLabelVisible&&(a||n),l=this.roomBoundViewData.roomDimensionsVisible&&this.roomBoundViewData.roomWallsVisible;this.room.canDisplayDimensions()&&!this.perimeterLabelsVisible&&this.fullLabelVisible&&!r&&l?(this.caretsInstanceBuffer.setVisibilityForInstances(this,!0),t[0].subVectors(this.room.w2,this.room.w1).normalize(),t[1].subVectors(this.room.w1,this.room.w2).normalize(),t[2].subVectors(this.room.l2,this.room.l1).normalize(),t[3].subVectors(this.room.l1,this.room.l2).normalize(),this.caretsInstanceBuffer.updateStateForInstances(this,[{normal:t[0],tip:this.room.w1,height:this.baseHeight},{normal:t[1],tip:this.room.w2,height:this.baseHeight},{normal:t[2],tip:this.room.l1,height:this.baseHeight},{normal:t[3],tip:this.room.l2,height:this.baseHeight}])):this.caretsInstanceBuffer.setVisibilityForInstances(this,!1)}})(),this.baseHeight+=.01,this.standardMaterial=b,this.renderOrder=l.S.ROOM,this.roomLabel=this.labelManager.createRoomLabel(t.floorId,t.id,this),this.roomLabel.setVisible(!t.hide),this.room=t,this.caretsInstanceBuffer.allocInstance(this),this.updateRoomLabelPositionAndText(!0),this.colors=C,this.extrusionMesh=new r.Mesh(D.getExtrudedGeo(this.room,this.baseHeight),this.depthMaterial),this.animation.onChanged((()=>{const t=this.prevColorState;this.standardMaterial.color.lerpColors(t.innerColor,this.targetColorScheme.innerColor,this.animation.value);const e=(0,a.C)(t.opacity,this.targetColorScheme.opacity,this.animation.value);this.opacity=e}));const{datumLines:y,perimeterLines:S,height:E}=this.calculateInsideModeLinePositions();this.insideModeLines=new x(y,S,E,u,t.floorId,this.units,this.cameraData.pose,this.roomBoundViewData,h,this.extrusionMesh),this.add(this.insideModeLines),this.matrixAutoUpdate=!1}hasIntersectionPriorityWithRespectTo(t){return!(!t.object||!t.object.isModelMesh)}dispose(){this.labelManager.deleteLabel(this.roomLabel);for(const t of this.perimeterLabels)this.labelManager.deleteLabel(t),t.dispose();for(const t of this.heightLabels)this.labelManager.deleteLabel(t),t.dispose();this.datumLabel&&(this.labelManager.deleteLabel(this.datumLabel),this.datumLabel.dispose()),this.clearHoverTimer(),this.caretsInstanceBuffer.removeInstance(this),super.dispose()}hoverRoomLabel(t){const e=()=>{if(!t&&this.roomLabel.getDisplayingTooltip()===t||t&&this.fullLabelVisible)return void(t||(this.labelHovered=!1,this.updateMaterial()));this.roomLabel.setDisplayingTooltip(t),this.updateMaterial();const e=this.roomLabel.label.collider.material;e.opacity=t?.65:0,e.transparent=!0,this.updateRoomLabelPositionAndText(!1),this.updateCarets()};this.labelHovered=t,t?null===this.hoverTimer&&(this.hoverTimer=window.setTimeout(e,c.jd),this.updateMaterial()):(e(),this.clearHoverTimer())}updateUnits(t){this.units=t,this.insideModeLines.updateUnits(this.units),this.updateLabels()}updateGeo(t){this.room=t;const e=isNaN(this.room.floorHeight)?this.calcBaseHeight(this.room):this.room.floorHeight;this.baseHeight=e+.01;const i=D.getGeoFromRoom(t,e);this.geometry.dispose(),this.geometry=i,this.geometry.computeBoundingBox();const s=D.getExtrudedGeo(t,e);this.extrusionMesh.geometry.dispose(),this.extrusionMesh.geometry=s,this.updateRoomLabelPositionAndText(!1),this.updateLabels(),this.createHeightObjects();const{datumLines:o,perimeterLines:a,height:n}=this.calculateInsideModeLinePositions();this.insideModeLines.updateEndpoints(o,a,n)}beforeRender(){this.standardMaterial.opacity=this.opacity*(1-this.pitchFactor)*Number(this.roomBoundViewData.roomWallsVisible);const t=this.dimState.active?.5:1;this.caretsInstanceBuffer.setOpacityForInstances(this,t),this.updateLabelBillboard(),this.updateMaterial(),this.updateCarets()}updateLabelBillboard(){if(this.isRoomLabelVisible()){const{position:t,rotation:e,projection:i}=this.cameraData.pose,{height:s}=this.cameraData,o=this.cameraData.isOrtho()?this.cameraData.zoom():1,a=this.cameraData.aspect(),n=.1;this.roomLabel.label.quaternion.copy(e),this.roomLabel.label.scaleBillboard(t,e,i,o,s,a,n),this.roomLabel.label.updateMatrix(),this.roomLabel.label.updateMatrixWorld()}}updateLabelVisibility(){const t=this.hoverState.active||this.labelHovered;this.perimeterLabelsVisible=this.roomBoundViewData.roomDimensionsVisible&&(this.selectState.active||t&&(0,v.aY)(this.pitchFactor))&&this.insideNess<.9,this.updateLabels();for(const t of this.perimeterLabels)t.setVisible(this.perimeterLabelsVisible);const e=this.perimeterLabelsVisible&&!(0,v.aY)(this.pitchFactor);for(const t of this.heightLabels)t.setVisible(e);this.datumLabel&&this.datumLabel.setVisible(e),this.updateCarets()}updateMaterial(){this.material=this.room.hide?this.hideMaterial:this.standardMaterial,super.updateMaterial();const t=this.hoverState.active||this.labelHovered,e=(0,v.aY)(this.pitchFactor);(this.selectState.active||t)&&!e&&this.roomBoundViewData.roomDimensionsVisible?this.heightLinesInScene||(this.add(this.heightLines),this.heightLinesInScene=!0):this.heightLinesInScene&&(this.remove(this.heightLines),this.heightLinesInScene=!1),t&&e&&(this.targetColorScheme=this.colors.hoverState),this.hideMaterial.uniforms.opacity.value=t?1:0;const i=this.standardMaterial;this.prevColorState.innerColor.copy(i.color),this.prevColorState.opacity=i.opacity,this.animation.modifyAnimation(0,1,c.JT,n.WD),this.roomLabel.setDimmed(this.dimState.active),this.roomLabel.setVisible(this.isRoomLabelVisible()),this.updateLabelVisibility()}isRoomLabelVisible(){const t=this.hoverState.active||this.labelHovered;return!(this.insideNess>.9)&&((!this.room.hide||t)&&this.potentialLabels.length>0)}updateText(t,e){this.potentialLabels=t,this.updateRoomLabelPositionAndText(e),this.updateCarets()}static getGeoFromRoom(t,e){const{points:i,faces:s}=t.getGeometry(),o=i.map((t=>[t.x,e,t.y])).flat(1),a=new r.BufferGeometry;return a.setAttribute("position",new r.BufferAttribute(new Float32Array(o),3)),a.setIndex(s.flat(1)),a}static getExtrudedGeo(t,e){const{points:i,faces:s}=t.getGeometry(),o=i.map((t=>[t.x,e,t.y])),a=s.slice(),n=t.calculateMinimalInnerLoop(.01);for(const t of n)for(let i=0;i<t.length;i++){const s=o.length,n=t[i],r=t[(i+1)%t.length],l=[n.x,e,n.z],h=[r.x,e,r.z],c=[r.x,e+100,r.z],d=[n.x,e+100,n.z];o.push(l,h,c,d),a.push([s+0,s+2,s+1],[s+0,s+3,s+2])}const l=new r.BufferGeometry;return l.setAttribute("position",new r.BufferAttribute(new Float32Array(o.flat(1)),3)),l.setIndex(a.flat(1)),l}updateRoomLabelPositionAndText(t){if(0===this.potentialLabels.length)return;const e=[];if(!t){const{position:t}=this.roomLabel.label,i={x:t.x,y:t.z};this.room.holesCW.find((t=>{const e=t.map((t=>({x:t.x,y:t.z})));return(0,u.L)(i,e)}))||e.push({point:t.clone(),radius:this.currRoomLabelRadius})}const i=this.room.getViewCenter(new r.Vector3,1.5);i.y=this.baseHeight+c.Dh;const s=this.room.getViewCenterDistance(1.5);e.push({point:i,radius:s});const{screenPosition:o}=(0,v.bz)(this.cameraData,i,new r.Vector2,new r.Vector3),a=new r.Vector2;for(const t of e){this.roomLabel.label.position.copy(t.point),this.roomLabel.label.position.y=this.baseHeight+c.Dh,this.currRoomLabelRadius=t.radius;let e=!1;this.fullLabelVisible=!0;for(const i of this.potentialLabels){const s=this.getLabelRadiusPx(i),n=1.5*this.worldRadiusToScreen(this.roomLabel.label.position,t.radius,a),r=a.distanceTo(o);if(!this.cameraData.pose.isOrtho()||s+r<=n||this.roomLabel.getDisplayingTooltip()){this.roomLabel.label.text=i,e=!0;break}this.fullLabelVisible=!1}if(e)break}}calculateInsideModeLinePositions(){const t=this.room.getMaxCeilingDatum(),e=[];if(t){const i=new r.Vector3(t.position.x,this.baseHeight,t.position.z),s=new r.Vector3(t.position.x,this.baseHeight+t.height,t.position.z);e.push({points:[i,s]})}const i=[],s=this.room.minimalInnerLoop;for(const t of s){const e=t.length;for(let s=0;s<e;s++){const o=(new r.Vector3).copy(t[s]);o.y=this.baseHeight;const a=(new r.Vector3).copy(t[(s+1)%e]);a.y=this.baseHeight,i.push({points:[o,a]})}}return{datumLines:e,perimeterLines:i,height:this.room.canDisplayHeight()?this.room.getMinCeilingHeight():void 0}}updateLabels(){var t;if(!this.perimeterLabelsVisible)return;const e=this.room.hide?[]:this.room.minimalInnerEdges,i=this.room.canDisplayHeight()?e.length:0;for(;e.length>this.perimeterLabels.length;)this.perimeterLabels.push(this.labelManager.createPerimeterLabel(this.room.floorId,this,!0));for(;i>this.heightLabels.length;){const t=this.labelManager.createHeightLabel(this.room.floorId,!1,this,!0);t.labelGroupId=this.room.id,this.heightLabels.push(t)}for(;e.length<this.perimeterLabels.length;){const t=this.perimeterLabels.pop();if(!t)throw new Error("Label should exist!");this.labelManager.deleteLabel(t)}for(;i<this.heightLabels.length;){const t=this.heightLabels.pop();if(!t)throw new Error("Label should exist!");this.labelManager.deleteLabel(t)}for(let t=0;t<e.length;t++){const s=e[t],o=s.start.clone();o.y=this.baseHeight;const a=s.end.clone();if(a.y=this.baseHeight,this.perimeterLabels[t].updateDimensions(o,a,0,this.units),i>0){const e=o.clone(),i=e.clone();i.y=this.baseHeight+this.room.getMinCeilingHeight(),this.heightLabels[t].updateDimensions(e,i,0,this.units)}}const s=this.room.getMaxCeilingDatum();if(null!=s){null==this.datumLabel&&(this.datumLabel=this.labelManager.createDatumLabel(this.room.floorId,this),this.datumLabel.labelGroupId=this.room.id+"_max_height",this.datumLabel.labelHeightFraction=2/3);const e=s.position.clone();e.y=this.baseHeight;const i=e.clone();i.y+=s.height,null===(t=this.datumLabel)||void 0===t||t.updateDimensions(e,i,0,this.units)}else this.datumLabel&&(this.datumLabel.dispose(),this.labelManager.deleteLabel(this.datumLabel),this.datumLabel=null);this.labelManager.needsImmediateCollsisionDetection()}clearHoverTimer(){null!==this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=null)}createHeightObjects(){this.heightLines.clear();const t={dashed:!1,dashSize:1,gapSize:1,lineWidth:1,color:s.V.WHITE,dashUnits:p.EX.METERS,depthWrite:!1,depthTest:!0,depthFunc:r.LessDepth,globalOpacity:1},e={dashed:!1,dashSize:.08,gapSize:.04,lineWidth:.5,color:s.V.WHITE,dashUnits:p.EX.METERS,depthWrite:!1,depthTest:!0,depthFunc:r.GreaterDepth,globalOpacity:.3},i={dashed:!0,dashSize:10,gapSize:4,lineWidth:1,color:s.V.WHITE,dashUnits:p.EX.PIXELS,depthWrite:!1,depthTest:!0,depthFunc:r.LessDepth,globalOpacity:1},o={dashed:!0,dashSize:10,gapSize:4,lineWidth:1,color:s.V.WHITE,dashUnits:p.EX.PIXELS,depthWrite:!1,depthTest:!0,depthFunc:r.GreaterDepth,globalOpacity:.3},a=[],n=(t,e,i=a)=>{i.push({points:[t.clone(),e.clone()]})},l=[],h=new r.Vector3,c=new r.Vector3,d=this.room.minimalInnerLoop,u=this.room.getMinCeilingHeight();for(const t of d){const e=t.length;for(let i=0;i<e;i++)h.copy(t[i]),h.y=this.baseHeight,c.copy(t[(i+1)%e]),c.y=this.baseHeight,n(h,c),this.room.canDisplayHeight()&&(h.y+=u,c.y+=u,n(h,c));if(this.room.canDisplayHeight())for(const e of t)h.copy(e),h.y=this.baseHeight,c.copy(h),c.y+=u,n(h,c)}const v=this.room.getMaxCeilingDatum();v&&(h.copy(v.position),h.y=this.baseHeight,c.copy(h),c.y+=v.height,n(h,c,l)),this.occlusionLine=new p.y4(a,e,this.cameraData.pose),this.perspectiveLine=new p.y4(a,t,this.cameraData.pose),this.occlusionDatums=new p.y4(l,o,this.cameraData.pose),this.perspectiveDatums=new p.y4(l,i,this.cameraData.pose);const m=[];for(const t of l)for(const e of t.points)m.push({position:e});this.datumCircles=new E(m,{radius:5}),this.heightLines.add(this.occlusionLine),this.heightLines.add(this.perspectiveLine),this.heightLines.add(this.occlusionDatums),this.heightLines.add(this.perspectiveDatums),this.heightLines.add(this.datumCircles)}setIsInside(t){this.insideModeLines.setUserIsInsideRoom(t)}onRender(t,e){this.pitchFactor=t,this.insideNess=e,this.raycastEnabled=e<.1&&(this.roomBoundViewData.roomDimensionsVisible||(0,v.aY)(this.pitchFactor)),this.insideModeLines.onRender(e);const i=(1-e)*t,s=1*i,o=.3*i;this.perspectiveLine&&this.occlusionLine&&(this.perspectiveLine.globalOpacity(s),this.occlusionLine.globalOpacity(o)),this.perspectiveDatums&&this.occlusionDatums&&this.datumCircles&&(this.perspectiveDatums.globalOpacity(s),this.occlusionDatums.globalOpacity(o),this.datumCircles.setMaterialParams({opacity:s}))}}},14938:(t,e,i)=>{"use strict";i.d(e,{r:()=>r});var s=i(39591),o=i(83916),a=i(68909),n=i(24250);class r extends a.Mesh{constructor(t,e,i,s,r){super(i,s),this.roomBoundsId=t,this.floorId=e,this.cameraData=r,this.animation=new o.z(0),this.prevColorState={opacity:1,innerColor:new a.Color,outerColor:new a.Color},this.pitchFactor=1,this.raycastEnabled=!0,this.fullyInitialized=!1,this.opacity=1,this.selectState={active:!1,on:()=>{this.updateMaterial()},off:()=>{this.updateMaterial()}},this.hoverState={active:!1,on:()=>{this.updateMaterial()},off:()=>this.updateMaterial()},this.highlightState={active:!1,on:()=>this.updateMaterial(),off:()=>this.updateMaterial()},this.dimState={active:!1,on:()=>this.updateMaterial(),off:()=>this.updateMaterial()},this.name=t,this.renderOrder=n.S.BASE}updateMaterial(){var t;let e=this.colors.baseState;this.dimState.active&&(e=this.colors.dimState),this.hoverState.active&&(e=this.colors.hoverState),this.highlightState.active&&(e=null!==(t=this.colors.highlightState)&&void 0!==t?t:this.colors.selectState),this.selectState.active&&(e=this.colors.selectState);e!==this.targetColorScheme&&(this.targetColorScheme=e)}tickAnimations(t){this.animation.tick(t)}dispose(){}raycast(t,e){if(!this.raycastEnabled)return;const i=[];super.raycast(t,i),i.length>0&&e.push(i[0])}beforeRender(){}onRender(t,e){this.pitchFactor=t,this.raycastEnabled=(0,s.aY)(this.pitchFactor)}}},11827:(t,e,i)=>{"use strict";i.d(e,{a:()=>n});var s=i(68909),o=i(90280),a=i(30745);const n=(()=>{const t=new s.Vector3,e=new s.Vector2,i=new s.Vector2,n=new s.Line3;return(r,l,h,c,d,u,p)=>{n.set(r,l);const v=n.closestPointToPoint(u.ray.origin,!0,t);e.set(v.x,v.z),i.set(u.ray.origin.x,u.ray.origin.z);const m=e.distanceTo(i),g=u.ray.origin.distanceTo(n.start),f=(0,o.ff)(g,c.pose.projection.asThreeMatrix4(),c.width),b=a.ub*f;m<.5*Math.max(h,a.FY)+b&&p.push({distance:g,object:d,point:v.clone(),face:{a:-1,b:-1,c:-1,materialIndex:-1,normal:new s.Vector3(0,1,0)}})}})()},30745:(t,e,i)=>{"use strict";i.d(e,{Dh:()=>c,FY:()=>a,GG:()=>m,IS:()=>l,JT:()=>r,Zc:()=>v,jd:()=>h,kt:()=>d,m7:()=>s,rH:()=>p,ub:()=>o,wX:()=>u,xX:()=>n});const s=.06,o=7,a=.1,n=.02,r=100,l=8,h=500,c=.9,d=1e3,u="room-label-collision",p=300,v=.1,m=20},41799:(t,e,i)=>{"use strict";i.d(e,{OW:()=>B,Om:()=>M,Tx:()=>R,p$:()=>O,zP:()=>V,zs:()=>P});var s=i(84252),o=i(68909),a=i(32686),n=i.n(a),r=i(47876),l=i.n(r),h=i(82312),c=i.n(h),d=i(93854),u=i.n(d),p=i(63380),v=i.n(p),m=i(1834),g=i.n(m),f=i(88464),b=i.n(f),y=i(4605),S=i.n(y),E=i(69555),x=i.n(E),C=i(17709),D=i.n(C),A=i(12201),w=i.n(A),L=i(76539),I=i.n(L),T=i(77661);const O={uniforms:{outlinePct:{value:.8},globalOpacity:{value:0}},vertexShader:n(),fragmentShader:l()},V={uniforms:{selectedWidth:{value:.03},globalOpacity:{value:0}},vertexShader:c(),fragmentShader:u()},P={uniforms:{globalOpacity:{value:0}},vertexShader:v(),fragmentShader:g()},M={uniforms:{opacity:{value:1},centerSpacing:{value:24},radius:{value:4},color:{value:s.V.LENS_GRAY}},vertexShader:b(),fragmentShader:S()},B={uniforms:{color:{type:"v4",value:s.V.WHITE},globalOpacity:{type:"f",value:0},outline:{value:1},outlineColor:{value:s.V.BLACK},screenSize:{value:new o.Vector2},tipPaddingPx:{value:2},widthPx:{value:12},heightPx:{value:6},aaPaddingPx:{value:2},metersPerPx:{value:.01},autoScale:{value:1}},vertexShader:x(),fragmentShader:D()},R={uniforms:{maxDistance:{value:T.sv}},vertexShader:w(),fragmentShader:I()}},27133:(t,e,i)=>{"use strict";i.d(e,{K:()=>o});var s=i(61589);class o extends s.B{constructor(t){super(),this.editorState=t,this.name="room-bound-editor-state-data",this.commit()}}},90022:(t,e,i)=>{"use strict";i.d(e,{D:()=>l});var s=i(23999),o=i(56245),a=i(44017),n=i(93881),r=i(66789);class l{constructor(t,e){this.editor=t,this.data=e,this.readBindings=[],this.mover={onMove:(t,e)=>{}},this.onCurrentChange=({target:t})=>{this.editor.state.toolState!==a.K.ToolState.ADDING&&this.clearHighlightedViews(),this.highlightView(t)},this.onSelectChange=({target:t})=>{this.setSelectedView(t)},this.onHoverChange=({target:t,previous:e})=>{if(this.editor.state.toolState===a.K.ToolState.ADDING)return;if(!t)return this.editor.clearAllDims(),this.editor.clearAllHighlights(),void(this.editor.state.selected&&this.setSelectedView(this.editor.state.selected));const i=this.data.getEntity(t);this.hoverView(i)},this.editableEntities=new n.F.EditorEntityAdapter(this.editor)}addEditableEntity(t,e){this.editableEntities.registerEntity(e,this,t)}removeEditableEntity(t){this.editableEntities.unregisterEntity(t)}activate(){0===this.readBindings.length?this.readBindings.push(this.editor.subscribe(r.S.Events.CurrentChange,this.onCurrentChange),this.editor.subscribe(r.S.Events.SelectChange,this.onSelectChange),this.editor.subscribe(a.K.Events.HoverChange,this.onHoverChange)):this.readBindings.forEach((t=>t.renew()))}deactivate(){this.readBindings.forEach((t=>t.cancel()))}clearHighlightedViews(){this.editor.clearAllHighlights()}highlightView(t){if(!t)return;const e=this.data.getEntity(t);e instanceof o.j&&this.editor.highlight(t,e.from.id,e.to.id)}setSelectedView(t){if(!t)return void this.editor.clearAllDims();const e=this.data.getEntity(t);e instanceof o.j&&this.editor.highlight(e.from.id,e.to.id),e instanceof s.pQ&&(this.clearHighlightedViews(),this.dimAllRooms(),this.selectRoom(e))}dimAllRooms(){this.editor.clearAllDims();for(const[,t]of this.data.rooms)this.dimRoom(t)}hoverView(t){t instanceof s.pQ&&this.hoverRoom(t)}hoverRoom(t){const e=t.id;this.editor.clearDim(e);for(const e of t.walls)this.editor.clearDim(e.id);for(const e of t.points)this.editor.clearDim(e.id)}selectRoom(t){const e=t.id;this.editor.clearDim(e);for(const e of t.walls)this.editor.clearDim(e.id);for(const e of t.points)this.editor.clearDim(e.id)}dimRoom(t){const e=t.id;this.editor.dim(e);for(const e of t.walls)this.editor.dim(e.id);for(const e of t.points)this.editor.dim(e.id)}}},8466:(t,e,i)=>{"use strict";i.d(e,{C:()=>o,Z:()=>a});var s=i(18268);class o extends s.u{constructor(t){super(),this.payload={id:t}}}o.id="roombound_unselect";class a extends s.u{constructor(t){super(),this.payload={allowRendering:t}}}a.id="room_bound_set_allow_rendering"},55756:(t,e,i)=>{"use strict";i.d(e,{M:()=>a});var s=i(61589),o=i(93159);class a extends s.B{constructor(t={}){super(),this.lastPublished=null,this.transactionState=o.i.IDLE,this.isInProcessingSubState=!1,Object.assign(this,t)}setTransactionState(t){if(t!==this.transactionState){if(![this.transactionState,t].includes(o.i.IDLE))throw new Error(`Cannot transition from ${this.transactionState} to ${t}`);this.transactionState=t,this.transactionState===o.i.IDLE&&(this.isInProcessingSubState=!1),this.commit()}}setProcessingSubState(t){if(t&&this.transactionState===o.i.IDLE)throw new Error("Cannot be in a Processing sub-state while Transaction State is Idle");this.isInProcessingSubState=t,this.commit()}}},93159:(t,e,i)=>{"use strict";var s,o;i.d(e,{i:()=>s,w:()=>o}),function(t){t.IDLE="idle",t.SAVING="saving"}(s||(s={})),function(t){t.ON="on",t.BEFORE="before",t.AFTER="after"}(o||(o={}))},46795:(t,e,i)=>{"use strict";i.d(e,{y:()=>o});var s=i(84252);const o=[{outerRadius:1,innerRadius:.97,color:s.V.BLACK.clone(),opacity:.1},{outerRadius:.97,innerRadius:.65,color:s.V.WHITE.clone(),opacity:.64},{outerRadius:.65,innerRadius:.62,color:s.V.BLACK.clone(),opacity:.13}]},60917:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var s=i(18268);class o extends s.u{constructor(t){super(),this.payload={enabled:t}}}o.id="TOGGLE_PUCK_EDITING"},27786:(t,e,i)=>{"use strict";i.d(e,{bK:()=>h,tx:()=>n});var s=i(68909),o=i(75673),a=i(48071);var n;!function(t){t[t.Axes=1]="Axes",t[t.PlanarAxes=2]="PlanarAxes",t[t.EdgesAndPlanarAxes=3]="EdgesAndPlanarAxes",t[t.Edges=4]="Edges",t[t.Free=5]="Free",t[t.Locked=6]="Locked"}(n||(n={}));const r={[a.os.UP]:{dir:Object.freeze(a.B1.UP.clone())},[a.os.DOWN]:{dir:Object.freeze(a.B1.DOWN.clone())},[a.os.BACK]:{dir:Object.freeze(a.B1.BACK.clone())},[a.os.LEFT]:{dir:Object.freeze(a.B1.LEFT.clone())},[a.os.RIGHT]:{dir:Object.freeze(a.B1.RIGHT.clone())},[a.os.FORWARD]:{dir:Object.freeze(a.B1.FORWARD.clone())}},l={[a.os.HORIZONTAL_PLANE]:{dir:Object.freeze(a.B1.HORIZONTAL_PLANE.clone())}},h=(()=>{let t=0;const e=new s.Vector3,i=new s.Vector3,h=new s.Vector3,c=new s.Vector3,d=999,u=Object.freeze(a.B1.ZERO.clone()),p=Object.keys(r).map((t=>Object.assign(Object.assign({},r[t]),{name:t,angleTo:d}))),v=Object.keys(l).map((t=>Object.assign(Object.assign({},l[t]),{name:t,angleTo:d}))),m=t=>(t+3)%2;let g=p[0];return(s,r,l=n.Axes)=>{if(l===n.Free)return{position:r.clone(),constrainedAxis:u,axisName:a.os.NONE};if(p.forEach((t=>t.angleTo=d)),v.forEach((t=>t.angleTo=d)),h.copy(r).sub(s),t=h.length(),t<.05)return{position:r.clone(),constrainedAxis:u,axisName:a.os.NONE};c.copy(h).normalize();const f=.05*Math.min(t,1);if(l!==n.Locked){for(const t of p){const e=(0,o.H)(c.angleTo(t.dir));e<g.angleTo&&(g=t),t.angleTo=e}if(g.angleTo>20){const t=Math.abs(h.y);t*t<f&&(g=v[0])}}e.set(s.x*m(g.dir.x),s.y*m(g.dir.y),s.z*m(g.dir.z)),i.set(r.x*Math.abs(g.dir.x),r.y*Math.abs(g.dir.y),r.z*Math.abs(g.dir.z)).add(e);return l===n.Locked||i.distanceToSquared(r)<f?{position:i.clone(),constrainedAxis:g.dir,axisName:g.name}:{position:r.clone(),constrainedAxis:u,axisName:a.os.NONE}}})()},93881:(t,e,i)=>{"use strict";i.d(e,{F:()=>o});var s,o,a=i(44017),n=i(66789);!function(t){class e extends a.K.DragAndDropBase{constructor(t=new i){super(t,new a.K.EventConstructors(s.AddStart,s.EditStart,s.AddConfirm,s.AddDiscard,s.EditConfirm,s.EditDiscard,s.Delete,s.Move,s.CurrentChange,s.SelectChange,s.ValidChange)),this.state=t}add(t){this.internalAdd(new Set(t))}edit(t){this.internalEdit(new Set(t))}place(t){this.internalPlace(new Set(t))}select(t,e){const i=(null==e?void 0:e.addToExistingSelection)&&this.state.selected?Array.from(this.state.selected.keys()).concat(t):t;this.internalSelect(new Set(i),e)}toggleSelect(t){var e;const i=new Set(null===(e=this.state.selected)||void 0===e?void 0:e.keys());for(const e of t)i.has(e)?i.delete(e):i.add(e);this.internalSelect(i)}}t.DragAndDrop=e;class i extends a.K.BaseState{}let s;t.State=i,function(t){class e extends a.K.Events.BaseAddStart{}t.AddStart=e;class i extends a.K.Events.BaseEditStart{}t.EditStart=i;class s extends a.K.Events.BaseAddConfirm{}t.AddConfirm=s;class o extends a.K.Events.BaseAddDiscard{}t.AddDiscard=o;class n extends a.K.Events.BaseEditConfirm{}t.EditConfirm=n;class r extends a.K.Events.BaseEditDiscard{}t.EditDiscard=r;class l extends a.K.Events.BaseDelete{}t.Delete=l;class h extends a.K.Events.BaseMove{}t.Move=h;class c extends a.K.Events.BaseCurrentChange{}t.CurrentChange=c;class d extends a.K.Events.BaseSelectChange{}t.SelectChange=d;class u extends a.K.Events.BaseValidChange{}t.ValidChange=u}(s=t.Events||(t.Events={}))}(s||(s={})),function(t){const e={[a.K.Events.HoverChange.type]:"hoverState",[a.K.Events.HighlightAdd.type]:"highlightState",[a.K.Events.HighlightClear.type]:"highlightState",[a.K.Events.DimAdd.type]:"dimState",[a.K.Events.DimClear.type]:"dimState"};class i{constructor(t){this.editor=t,this.bindings=[],this.entities=new Map,this.bindings.push(this.editor.subscribe(a.K.Events.HoverChange,(t=>this.bindTargetedCallback(a.K.Events.HoverChange.type,t))),this.editor.subscribe(a.K.Events.HighlightAdd,(t=>this.bindTargetedCallback(a.K.Events.HighlightAdd.type,t))),this.editor.subscribe(a.K.Events.HighlightClear,(t=>this.bindClearCallback(a.K.Events.HighlightClear.type,t))),this.editor.subscribe(a.K.Events.DimAdd,(t=>this.bindTargetedCallback(a.K.Events.DimAdd.type,t))),this.editor.subscribe(a.K.Events.DimClear,(t=>this.bindClearCallback(a.K.Events.DimClear.type,t))))}registerEntity(t,...e){let i=this.entities.get(t);i||(i=[]),i.push(...e),this.entities.set(t,i)}unregisterEntity(t){return this.entities.delete(t)}bindTargetedCallback(t,e){const{target:i,previousTarget:s}=this.getTargetAndPrevIds(e),o=this.eventToCallbackMapping[t];if(!o)throw Error(`implement targetted callback for ${t}`);for(const t of s)(this.entities.get(t)||[]).forEach((t=>{o in t&&(t[o].active=!1,t[o].off())}));for(const t of i)(this.entities.get(t)||[]).forEach((t=>{o in t&&(t[o].active=!0,t[o].on())}))}bindMoveCallback(t){const{target:e}=this.getTargetAndPrevIds(t);for(const i of e)(this.entities.get(i)||[]).forEach((e=>{e.mover&&t.target&&e.mover.onMove(i,t.ev)}))}bindClearCallback(t,e){const i=this.eventToCallbackMapping[t],{target:s}=this.getTargetAndPrevIds(e);for(const t of s)(this.entities.get(t)||[]).forEach((t=>{i in t&&(t[i].active=!1,t[i].off())}))}}t.BaseEditorEntityAdapter=i;t.EditorEntityAdapter=class extends i{constructor(t){super(t),this.eventToCallbackMapping=Object.assign(Object.assign({},e),{[n.S.Events.SelectChange.type]:"selectState",[n.S.Events.ValidChange.type]:"validState",[n.S.Events.Move.type]:"mover"}),this.bindings.push(this.editor.subscribe(n.S.Events.SelectChange,(t=>this.bindTargetedCallback(n.S.Events.SelectChange.type,t))),this.editor.subscribe(n.S.Events.ValidChange,(t=>this.bindTargetedCallback(n.S.Events.ValidChange.type,t))),this.editor.subscribe(n.S.Events.Move,(t=>this.bindMoveCallback(t))))}getTargetAndPrevIds(t){if(a.K.Events.hasTargetAndPrev(t))return{target:t.target?[t.target]:[],previousTarget:t.previous?[t.previous]:[]};if(a.K.Events.hasTarget(t))return{target:t.target?[t.target]:[],previousTarget:[]};throw new Error("Unexpected message!!")}};t.MultiSelectEditorEntityAdapter=class extends i{constructor(t){super(t),this.eventToCallbackMapping=Object.assign(Object.assign({},e),{[s.Events.SelectChange.type]:"selectState",[s.Events.ValidChange.type]:"validState",[s.Events.Move.type]:"mover"}),this.bindings.push(this.editor.subscribe(s.Events.SelectChange,(t=>this.bindTargetedCallback(s.Events.SelectChange.type,t))),this.editor.subscribe(s.Events.ValidChange,(t=>this.bindTargetedCallback(s.Events.ValidChange.type,t))),this.editor.subscribe(s.Events.Move,(t=>this.bindMoveCallback(t))))}getTargetAndPrevIds(t){const e=t=>t instanceof Set?Array.from(t.keys()):null!==t?[t]:[];if(a.K.Events.hasTargetAndPrev(t))return{target:t.target?e(t.target):[],previousTarget:t.previous?e(t.previous):[]};if(a.K.Events.hasTarget(t))return{target:t.target?e(t.target):[],previousTarget:[]};throw new Error("Unexpected message!!")}}}(o||(o={}))},44017:(t,e,i)=>{"use strict";i.d(e,{K:()=>d});var s=i(17250),o=i(61693),a=i(41733),n=i(2789),r=i(14754),l=i(35652),h=i(84229);const c=new l.Ay("editor");var d;!function(t){t.DragAndDropBase=class{subscribe(t,e){return this.events.subscribe(t,e)}constructor(t=new l,e){this.state=t,this.eventConstructors=e,this.events=new s.Q,this.bindings=[],this.validator=null,this.state.commit(),this.bindings.push(this.state.onPropertyChanged("toolState",(()=>{c.debug("toolState:",{from:this.state.previousToolState,to:this.state.toolState},this.state),this.events.broadcast(new i.StateChange(this.state.toolState,this.state.previousToolState))})),this.onSelectedChanged(((t,i)=>{this.events.broadcast(new e.SelectChange(t,i))})),this.onHoveredChanged(((t,e)=>{this.events.broadcast(new i.HoverChange(t,e))})),this.state.onCurrentIdChanged(((t,i)=>{this.events.broadcast(new e.CurrentChange(t,i))}))),this.bindings.forEach((t=>t.cancel()))}setState(t){t!==this.state.toolState&&(this.state.previousToolState=this.state.toolState,this.state.toolState=t,this.state.commit())}start(){const{toolState:t}=this.state;if(t!==e.CLOSED)throw new d("Editor already started");this.bindings.forEach((t=>t.renew())),this.setState(e.IDLE),this.events.broadcast(new i.Start)}setEnabled(t){if(this.state.toolState===e.CLOSED)throw new d("Editor not started");if(t)this.state.toolState===e.DISABLED&&this.setState(e.IDLE);else switch(this.state.toolState){case e.DISABLED:break;case e.IDLE:this.setState(e.DISABLED);break;default:this.unhover({commit:!1}),this.deselect({commit:!1}),this.discard(),this.setState(e.DISABLED)}}exit(){this.state.toolState!==e.CLOSED&&(this.state.toolState!==e.DISABLED&&(this.unhover({commit:!1}),this.deselect({commit:!1}),this.discard()),this.setState(e.CLOSED),this.bindings.forEach((t=>t.cancel())),this.events.broadcast(new i.Exit))}setValidator(t){this.validator=t}onDiscard(t){this.state.onBeforeDiscard=t||null}internalEdit(t){if(this.assertActive(),null!==this.state.pendingEdit)throw c.error(`Trying to edit asset ${t}, but currently editing ${this.state.pendingEdit}`),new d("Edit in progress");this.state.pendingEdit=t,this.setState(e.EDITING),this.events.broadcast(new this.eventConstructors.EditStart(t,!1))}waitForAdd(){if(this.assertActive(),null!==this.state.pendingAdd)throw c.error(`Entering wait for add state, but already adding ${this.state.pendingAdd}`),new d("Add in progress");null!==this.state.selected&&(c.debug(`Entering the wait for add state, deselecting previous ${this.state.selected}`),this.deselect({commit:!1})),this.events.broadcast(new i.WaitForAddStart),this.setState(e.WAIT_FOR_ADD)}internalAdd(t){if(this.assertActive(),null!==this.state.pendingAdd)throw c.error(`Trying to add new asset ${t}, but already adding ${this.state.pendingAdd}`),new d("Add in progress");null!==this.state.selected&&(c.debug(`Add ${t} called, deselecting previous ${this.state.selected}`),this.deselect({commit:!1})),this.state.pendingAdd=t,this.events.broadcast(new this.eventConstructors.AddStart(t)),this.setState(e.ADDING)}internalPlace(t){this.assertActive();const{pendingAdd:i,pendingEdit:s}=this.state,o=i||s;o&&t===o||(this.state.pendingEdit=t),this.setState(e.PLACING),this.events.broadcast(new this.eventConstructors.EditStart(t,!0))}move(t){this.assertActive(),this.validate(t);const{pendingAdd:e,pendingEdit:i,selected:s}=this.state,o=e||i||s;o&&this.events.broadcast(new this.eventConstructors.Move(o,t)),this.state.ndcPosition.value=t.clientPosition}highlight(...t){this.assertActive();for(const e of t)this.state.highlighted.add(e),this.events.broadcast(new i.HighlightAdd(e))}clearHighlight(...t){this.assertActive();for(const e of t)this.state.highlighted.delete(e),this.events.broadcast(new i.HighlightClear(e))}clearAllHighlights(){this.assertActive();for(const t of this.state.highlighted)this.events.broadcast(new i.HighlightClear(t));this.state.highlighted.clear()}dim(t){this.assertActive(),this.state.dimmed.add(t),this.events.broadcast(new i.DimAdd(t))}clearDim(t){this.assertActive(),this.state.dimmed.delete(t),this.events.broadcast(new i.DimClear(t))}clearAllDims(){this.assertActive();for(const t of this.state.dimmed)this.events.broadcast(new i.DimClear(t));this.state.dimmed.clear()}internalSelect(t,i){this.assertActive(),this.state.pendingAdd||this.state.pendingEdit||(this.state.previousSelected=this.state.selected,this.state.selected=t,this.state.commit(),i&&i.transitionTo?this.setState(i.transitionTo):this.setState(e.SELECTED))}deselect(t={commit:!0}){this.assertActive(),this.state.pendingAdd||this.state.pendingEdit||null!==this.state.selected&&(this.state.previousSelected=this.state.selected,this.state.selected=null,t.commit&&this.state.commit(),t&&t.transitionTo?this.setState(t.transitionTo):this.setState(e.IDLE))}hover(t){this.assertActive(),t!==this.state.hovered&&(this.state.previousHovered=this.state.hovered,this.state.hovered=t,this.state.commit())}unhover(t={commit:!0}){this.state.hovered&&(this.state.previousHovered=this.state.hovered,this.state.hovered=null,t.commit&&this.state.commit())}tryCommit(){this.assertActive();const t=this.state.pendingAdd,e=this.state.pendingEdit;if(!1===this.state.pendingValid)return c.warn("nop, pendingValid",this.state.pendingValid),!1;let i=!1;const s=this.state.selected,o=this.state.pendingAdd||this.state.pendingEdit;if(o){const a=null===this.state.pendingValid||!0===this.state.pendingValid;a&&(this.state.pendingAdd=null,this.state.pendingEdit=null,this.state.pendingValid=null,this.state.onBeforeDiscard=null,e&&this.events.broadcast(new this.eventConstructors.EditConfirm(e)),t&&this.events.broadcast(new this.eventConstructors.AddConfirm(t)),this.state.pendingAdd||this.state.pendingEdit||s!==this.state.selected||this.internalSelect(o)),i=a}return i}discard(){const t=this.state.pendingAdd||this.state.pendingEdit,i=this.state.pendingAdd,s=this.state.pendingEdit;t&&(this.state.onBeforeDiscard&&this.state.onBeforeDiscard(),s&&(this.state.pendingEdit=null,this.events.broadcast(new this.eventConstructors.EditDiscard(s))),i&&(this.state.pendingAdd=null,this.events.broadcast(new this.eventConstructors.AddDiscard(i))),this.events.broadcast(new this.eventConstructors.ValidChange(null,null)),this.state.pendingValid=null,this.state.onBeforeDiscard=null),this.unhover({commit:!1}),this.deselect({commit:!1}),this.state.toolState!==e.IDLE&&this.setState(e.IDLE),this.state.commit()}validate(t){const e=this.state.pendingAdd||this.state.pendingEdit||this.state.selected;if(e){const i=this.state.pendingValid;let s=!0;this.validator?(s=this.validator.validate(e,t),this.state.pendingValid=s):this.state.pendingValid=null,null!==this.state.pendingValid&&i!==this.state.pendingValid&&this.events.broadcast(new this.eventConstructors.ValidChange(s?e:null,s?null:e))}}assertActive(){if(this.state.toolState===t.ToolState.CLOSED)throw new d("Editor closed");if(this.state.toolState===t.ToolState.DISABLED)throw new d("Editor disabled")}onSelectedChanged(t){return this.state.onPropertyChanged("selected",(()=>t(this.state.selected,this.state.previousSelected)))}onHoveredChanged(t){return this.state.onPropertyChanged("hovered",(()=>t(this.state.hovered,this.state.previousHovered)))}};let e,i;t.EventConstructors=class{constructor(t,e,i,s,o,a,n,r,l,h,c){this.AddStart=t,this.EditStart=e,this.AddConfirm=i,this.AddDiscard=s,this.EditConfirm=o,this.EditDiscard=a,this.Delete=n,this.Move=r,this.CurrentChange=l,this.SelectChange=h,this.ValidChange=c}},function(t){t.CLOSED="CLOSED",t.DISABLED="DISABLED",t.IDLE="IDLE",t.SELECTED="SELECTED",t.WAIT_FOR_ADD="WAIT_FOR_ADD",t.ADDING="ADDING",t.EDITING="EDITING",t.PLACING="PLACING"}(e=t.ToolState||(t.ToolState={}));class l extends o.v{constructor(){super(...arguments),this.toolState=e.CLOSED,this.previousToolState=e.CLOSED,this.pendingAdd=null,this.pendingEdit=null,this.selected=null,this.previousSelected=null,this.hovered=null,this.previousHovered=null,this.highlighted=new Set,this.dimmed=new Set,this.ndcPosition=new a.L(null),this.onBeforeDiscard=null,this.pendingValid=null}get currentId(){return this.pendingAdd||this.pendingEdit||this.selected||null}onCurrentIdChanged(t,e=!1){let i=this.currentId;const s=()=>{this.currentId!==i&&(t(this.currentId,i),i=this.currentId)},o=new n.P(this.onPropertyChanged("selected",s),this.onPropertyChanged("pendingAdd",s),this.onPropertyChanged("pendingEdit",s));return e?o.renew():o.cancel(),o}}t.BaseState=l;class d extends h.t{constructor(t="invalid state"){super(t),this.name="invalid state"}}t.EditorException=d,function(t){class e extends r.QB{}e.type="edit",t.EditEvent=e;class i extends e{constructor(t){super(),this.target=t}}i.type="editt",t.BaseEditTarget=i;class s extends e{constructor(t,e){super(),this.target=t,this.previous=e}}s.type="edittp",t.BaseEditTargetAndPrev=s;class o extends e{constructor(t,e){super(),this.target=t,this.previous=e}}o.type="toolchange",t.StateChange=o;class a extends e{}a.type="editorstart",t.Start=a;class n extends e{}n.type="editorexit",t.Exit=n;class l extends e{}l.type="waitforaddstart",t.WaitForAddStart=l;class h extends i{}h.type="addstart",t.BaseAddStart=h;class c extends i{constructor(t,e){super(t),this.placeOnly=e}}c.type="editstart",t.BaseEditStart=c;class d extends i{}d.type="addconfirm",t.BaseAddConfirm=d;class u extends i{}u.type="adddiscard",t.BaseAddDiscard=u;class p extends i{}p.type="editconfirm",t.BaseEditConfirm=p;class v extends i{}v.type="editdiscard",t.BaseEditDiscard=v;class m extends i{}m.type="delete",t.BaseDelete=m;class g extends i{constructor(t,e){super(t),this.target=t,this.ev=e}}g.type="move",t.BaseMove=g;class f extends s{}f.type="target",t.BaseCurrentChange=f;class b extends s{}b.type="hover",t.HoverChange=b;class y extends s{}y.type="select",t.BaseSelectChange=y;class S extends i{}S.type="highlight",t.HighlightAdd=S;class E extends i{}E.type="highlightclear",t.HighlightClear=E;class x extends i{}x.type="dim",t.DimAdd=x;class C extends i{}C.type="dimclear",t.DimClear=C;class D extends s{}D.type="valid",t.BaseValidChange=D,t.hasTarget=function(t){return t instanceof i},t.hasTargetAndPrev=function(t){return t instanceof s}}(i=t.Events||(t.Events={}))}(d||(d={}))},66789:(t,e,i)=>{"use strict";i.d(e,{S:()=>s});var s,o=i(44017);!function(t){class e extends o.K.DragAndDropBase{constructor(t=new i){super(t,new o.K.EventConstructors(s.AddStart,s.EditStart,s.AddConfirm,s.AddDiscard,s.EditConfirm,s.EditDiscard,s.Delete,s.Move,s.CurrentChange,s.SelectChange,s.ValidChange)),this.state=t}add(t){this.internalAdd(t)}edit(t){this.internalEdit(t)}place(t){this.internalPlace(t)}select(t,e){this.internalSelect(t,e)}toggleSelect(t){this.state.selected===t?this.deselect():this.select(t)}}t.DragAndDrop=e;class i extends o.K.BaseState{}let s;t.State=i,function(t){class e extends o.K.Events.BaseAddStart{}t.AddStart=e;class i extends o.K.Events.BaseEditStart{}t.EditStart=i;class s extends o.K.Events.BaseAddConfirm{}t.AddConfirm=s;class a extends o.K.Events.BaseAddDiscard{}t.AddDiscard=a;class n extends o.K.Events.BaseEditConfirm{}t.EditConfirm=n;class r extends o.K.Events.BaseEditDiscard{}t.EditDiscard=r;class l extends o.K.Events.BaseDelete{}t.Delete=l;class h extends o.K.Events.BaseMove{}t.Move=h;class c extends o.K.Events.BaseCurrentChange{}t.CurrentChange=c;class d extends o.K.Events.BaseSelectChange{}t.SelectChange=d;class u extends o.K.Events.BaseValidChange{}t.ValidChange=u}(s=t.Events||(t.Events={}))}(s||(s={}))},17709:t=>{t.exports="precision highp float;uniform float aaPaddingPx;uniform vec3 color;uniform float globalOpacity;varying vec2 vOffsetPx;uniform float outline;uniform vec3 outlineColor;varying vec2 scaledWidthHeightPx;varying float vOpacity;float sdTriangle(vec2 p,vec2 p0,vec2 p1,vec2 p2){vec2 e0=p1-p0;vec2 e1=p2-p1;vec2 e2=p0-p2;vec2 v0=p-p0;vec2 v1=p-p1;vec2 v2=p-p2;vec2 pq0=v0-e0*clamp(dot(v0,e0)/dot(e0,e0),0.,1.);vec2 pq1=v1-e1*clamp(dot(v1,e1)/dot(e1,e1),0.,1.);vec2 pq2=v2-e2*clamp(dot(v2,e2)/dot(e2,e2),0.,1.);float s=e0.x*e2.y-e0.y*e2.x;vec2 d=min(min(vec2(dot(pq0,pq0),s*(v0.x*e0.y-v0.y*e0.x)),vec2(dot(pq1,pq1),s*(v1.x*e1.y-v1.y*e1.x))),vec2(dot(pq2,pq2),s*(v2.x*e2.y-v2.y*e2.x)));return-sqrt(d.x)*sign(d.y);}void main(){float padding=aaPaddingPx+outline;float halfWidth=scaledWidthHeightPx.x/2.;vec2 p0=vec2(-halfWidth,scaledWidthHeightPx.y+padding);vec2 p1=vec2(halfWidth,scaledWidthHeightPx.y+padding);vec2 p2=vec2(0.,padding);float sd=sdTriangle(vOffsetPx,p0,p1,p2);float aaOpacity=1.-smoothstep(outline,outline+0.5,sd);float colorMix=smoothstep(0.,outline,sd);vec3 colorWithOutline=mix(color,outlineColor,colorMix);gl_FragColor=linearToOutputTexel(vec4(colorWithOutline,aaOpacity*globalOpacity*vOpacity));}"},69555:t=>{t.exports="precision highp float;uniform vec2 screenSize;vec2 rotate90(vec2 v){return vec2(-v.y,v.x);}vec2 ndcToScreen(vec4 pt){return(vec2(pt.x,pt.y)+vec2(1.,1.))*screenSize/2.;}vec2 screenToNdc(vec2 pt){return(pt*2./screenSize)-vec2(1.,1.);}\n#define MIN_SCALE  0.4\n#define MIN_METERS_PER_PX  0.006\n#define MAX_METERS_PER_PX  0.012\nuniform float tipPaddingPx;uniform float widthPx;uniform float heightPx;uniform float aaPaddingPx;uniform float metersPerPx;uniform float outline;uniform float autoScale;attribute vec2 offset;attribute vec2 tip;attribute float height;attribute float opacity;attribute float visibility;varying vec2 vOffsetPx;varying vec2 scaledWidthHeightPx;varying float vOpacity;vec2 scaleByZoom(){float t=clamp((metersPerPx-MIN_METERS_PER_PX)/(MAX_METERS_PER_PX-MIN_METERS_PER_PX),0.,1.);float scale=1.;if(autoScale>0.){scale=mix(1.,MIN_SCALE,t);}return vec2(widthPx,heightPx)*scale;}void main(){if(visibility>0.){vec2 yAxis=normal.xy;vec2 xAxis=rotate90(yAxis);vec4 tipWorld=vec4(tip.x,height,tip.y,1.);vec4 xOffsetWorld=tipWorld+vec4(xAxis.x,0.,xAxis.y,0.);vec4 yOffsetWorld=tipWorld+vec4(yAxis.x,0.,yAxis.y,0.);vec4 ndcTip=projectionMatrix*modelViewMatrix*tipWorld;vec2 tipScreen=ndcToScreen(ndcTip/ndcTip.w);vec4 ndcXOffset=projectionMatrix*modelViewMatrix*xOffsetWorld;vec2 xOffsetScreen=ndcToScreen(ndcXOffset/ndcXOffset.w);vec4 ndcYOffset=projectionMatrix*modelViewMatrix*yOffsetWorld;vec2 yOffsetScreen=ndcToScreen(ndcYOffset/ndcYOffset.w);vec2 xAxisScreen=normalize(xOffsetScreen-tipScreen);vec2 yAxisScreen=normalize(yOffsetScreen-tipScreen);float padding=aaPaddingPx+outline;scaledWidthHeightPx=scaleByZoom();float halfWidth=scaledWidthHeightPx.x/2.+padding;float quadHeight=scaledWidthHeightPx.y+padding*2.;vec2 vertexScreen=(tipScreen+yAxisScreen*tipPaddingPx)+xAxisScreen*halfWidth*offset.x+yAxisScreen*quadHeight*offset.y;vec2 ndcVert=screenToNdc(vertexScreen);vOffsetPx=vec2(offset.x*halfWidth,offset.y*quadHeight);vOpacity=opacity;gl_Position=vec4(ndcVert*ndcTip.w,ndcTip.z,ndcTip.w);}else{gl_Position=vec4(-1000.,-1000.,-1000.,-1000.);}}"},4605:t=>{t.exports="precision highp float;uniform float opacity;uniform float centerSpacing;uniform float radius;uniform vec3 color;void main(){vec2 center=mod(gl_FragCoord.xy,vec2(centerSpacing))-vec2(centerSpacing*0.5);float polkaDot=1.-smoothstep(radius-(radius*0.2),radius,length(center));gl_FragColor=linearToOutputTexel(vec4(color,opacity*polkaDot));}"},88464:t=>{t.exports="precision highp float;void main(){gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},47876:t=>{t.exports="#define ANTIALIAS_WIDTH  1.0\nprecision highp float;uniform float globalOpacity;uniform float outlinePct;varying vec3 vOuterColor;varying vec3 vInnerColor;varying float vRadius;varying float vOpacity;varying vec3 vPosition;void main(){float fragRadius=length(vPosition.xz);float outlineRadius=vRadius*outlinePct;float smoothAmt=fwidth(fragRadius)*ANTIALIAS_WIDTH;float mixAmt=smoothstep(outlineRadius-smoothAmt,outlineRadius,fragRadius);gl_FragColor=linearToOutputTexel(vec4(mix(vInnerColor,vOuterColor,mixAmt),1.));gl_FragColor.a=globalOpacity*vOpacity*(1.-smoothstep(vRadius-smoothAmt,vRadius,fragRadius));}"},32686:t=>{t.exports="precision highp float;attribute vec3 centerPosition;attribute float radius;attribute float opacity;attribute vec3 innerColor;attribute vec3 outerColor;varying vec3 vPosition;varying float vRadius;varying float vOpacity;varying vec3 vInnerColor;varying vec3 vOuterColor;void main(){vPosition=position;vRadius=radius;vOpacity=opacity;vInnerColor=innerColor;vOuterColor=outerColor;vec3 worldPos=position+centerPosition;gl_Position=projectionMatrix*modelViewMatrix*vec4(worldPos,1.);}"},76539:t=>{t.exports="precision highp float;precision highp int;vec3 closestPointToRay(vec3 point,vec3 origin,vec3 direction){vec3 d=point-origin;float D=dot(d,direction);return origin+D*direction;}vec3 rayIntersectsSphere(vec3 origin,float radius,vec3 rayOrigin,vec3 rayDirection){vec3 chordPoint=closestPointToRay(origin,rayOrigin,rayDirection);float D1=length(rayOrigin-chordPoint);float D=length(chordPoint-origin);float D2=sqrt(radius*radius-D*D);return rayOrigin+(D1+D2)*rayDirection;}uniform vec3 color;uniform float maxDistance;varying vec3 vWorldPosition;vec4 normalizeDepth(float depth){float depthNormalized=clamp(depth/maxDistance,0.,1.);return vec4(depthNormalized,0.,0.,1.);}void main(){float distanceToCamera=distance(cameraPosition,vWorldPosition);gl_FragColor=normalizeDepth(distanceToCamera);}"},12201:t=>{t.exports="precision highp float;precision highp int;varying vec3 vWorldPosition;void main(){vWorldPosition=(modelMatrix*vec4(position,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},1834:t=>{t.exports="precision highp float;uniform float globalOpacity;varying vec3 vBaseColor;varying float vIsDoor;varying vec3 vPosition;void main(){const float lineWidth=0.15;if(vIsDoor>0.){const float startZ=0.15;const float endZ=startZ+lineWidth;float alpha=(abs(vPosition.z)>startZ&&abs(vPosition.z)<endZ)?1.:0.;gl_FragColor=vec4(vBaseColor,alpha*globalOpacity);}else{float alpha=(abs(vPosition.z)<lineWidth*0.5)?1.:0.;gl_FragColor=vec4(vBaseColor,alpha*globalOpacity);}gl_FragColor=linearToOutputTexel(gl_FragColor);}"},63380:t=>{t.exports="precision highp float;attribute float rotationY;attribute vec3 offset;attribute vec3 scaleAttr;attribute vec3 baseColor;attribute float isDoor;varying vec3 vPosition;varying vec3 vBaseColor;varying float vIsDoor;vec3 rotateY(vec3 v,float r){float c2=cos(r/2.);float s2=sin(r/2.);float qy=s2;float qw=c2;float tx=2.*qy*v.z;float tz=2.*(-qy*v.x);float x=v.x+qw*tx+qy*tz;float y=v.y;float z=v.z+qw*tz-qy*tx;return vec3(x,y,z);}void main(){vPosition=position;vBaseColor=baseColor;vIsDoor=isDoor;vec3 wsPosition=rotateY(position*scaleAttr,rotationY)+offset;gl_Position=projectionMatrix*modelViewMatrix*vec4(wsPosition,1.);}"},93854:t=>{t.exports="#define ANTIALIAS_WIDTH  1.0\nprecision highp float;uniform float selectedWidth;uniform float globalOpacity;varying vec3 outlineColor;varying vec3 color;varying float opacity;varying float width;varying vec3 lineStart;varying vec3 lineEnd;varying vec3 vWorldPos;float distanceBetween(vec2 l1,vec2 l2,vec2 p){float D=length(l2-l1);float N=abs((l2.x-l1.x)*(l1.y-p.y)-(l1.x-p.x)*(l2.y-l1.y));return N/D;}void main(){float distanceToLine=distanceBetween(lineStart.xz,lineEnd.xz,vWorldPos.xz);float aaWidth=fwidth(distanceToLine)*ANTIALIAS_WIDTH;float lineLerp=smoothstep(selectedWidth-aaWidth,selectedWidth,distanceToLine);float halfWidth=width*0.5;float aaOpacity=smoothstep(halfWidth,halfWidth-aaWidth,distanceToLine);float finalOpacity=opacity*globalOpacity*aaOpacity;gl_FragColor=linearToOutputTexel(mix(vec4(outlineColor,finalOpacity),vec4(color,finalOpacity),lineLerp));if(gl_FragColor.a<0.01){discard;}}"},82312:t=>{t.exports="precision highp float;attribute vec4 colorAndOpacity;attribute vec3 outlineColorAttr;attribute vec4 lineBiasedStartAndEnd;attribute float widthAttr;attribute float baseHeight;attribute vec4 fromLeft;attribute vec4 fromRight;attribute vec4 toLeft;attribute vec4 toRight;attribute vec4 lineStartAndEnd;attribute float vertIndex;varying vec3 outlineColor;varying vec3 color;varying float opacity;varying float width;varying vec3 lineStart;varying vec3 lineEnd;varying vec3 vWorldPos;void main(){vec3 position=vec3(0.,0.,0.);if(floor(vertIndex)==0.){position=vec3(lineStartAndEnd.x,baseHeight,lineStartAndEnd.y);}else if(floor(vertIndex)==3.){position=vec3(lineStartAndEnd.z,baseHeight,lineStartAndEnd.w);}else if(floor(vertIndex)==1.){position=vec3(fromRight.x,baseHeight,fromRight.y);}else if(floor(vertIndex)==2.){position=vec3(toRight.x,baseHeight,toRight.y);}else if(floor(vertIndex)==4.){position=vec3(toLeft.x,baseHeight,toLeft.y);}else if(floor(vertIndex)==5.){position=vec3(fromLeft.x,baseHeight,fromLeft.y);}else if(floor(vertIndex)==9.){position=vec3(fromRight.z,baseHeight,fromRight.w);}else if(floor(vertIndex)==6.){position=vec3(toRight.z,baseHeight,toRight.w);}else if(floor(vertIndex)==7.){position=vec3(toLeft.z,baseHeight,toLeft.w);}else if(floor(vertIndex)==8.){position=vec3(fromLeft.z,baseHeight,fromLeft.w);}outlineColor=outlineColorAttr;color=colorAndOpacity.xyz;opacity=colorAndOpacity.w;width=widthAttr;lineStart=vec3(lineBiasedStartAndEnd.x,baseHeight,lineBiasedStartAndEnd.y);lineEnd=vec3(lineBiasedStartAndEnd.z,baseHeight,lineBiasedStartAndEnd.w);vWorldPos=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},68216:t=>{t.exports="precision highp float;uniform vec3 color;uniform float opacity;uniform float radius;varying vec2 vCenter;varying vec2 vScreenPos;void main(){float distanceFromCenter=length(vScreenPos-vCenter);float sdfOpacity=1.-smoothstep(radius-0.5,radius+0.5,distanceFromCenter);float alpha=sdfOpacity*opacity;if(alpha<0.01){discard;}gl_FragColor=linearToOutputTexel(vec4(color,alpha));}"},45138:t=>{t.exports="precision highp float;uniform vec2 screenSize;vec2 rotate90(vec2 v){return vec2(-v.y,v.x);}vec2 ndcToScreen(vec4 pt){return(vec2(pt.x,pt.y)+vec2(1.,1.))*screenSize/2.;}vec2 screenToNdc(vec2 pt){return(pt*2./screenSize)-vec2(1.,1.);}\n#define ANTIALIAS_BUFFER  10.0\nuniform float radius;attribute vec3 center;attribute vec2 offsetDirection;varying vec2 vCenter;varying vec2 vScreenPos;void main(){vec4 centerNdc=projectionMatrix*modelViewMatrix*vec4(center,1.);vec2 centerScreen=ndcToScreen(centerNdc/centerNdc.w);vec2 vertexScreen=centerScreen+normalize(offsetDirection)*(radius+ANTIALIAS_BUFFER);vec2 vertexNdc=screenToNdc(vertexScreen);vCenter=centerScreen;vScreenPos=vertexScreen;gl_Position=vec4(vertexNdc*centerNdc.w,centerNdc.z,centerNdc.w);}"}}]);